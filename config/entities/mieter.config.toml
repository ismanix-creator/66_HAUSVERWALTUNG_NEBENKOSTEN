[entity]
name = "mieter"
label = "labels.entity.mieter"
label_plural = "labels.entity.mieter_plural"
icon = "User"
primary_key = "id"

[entity.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entity.fields.anrede]
type = "enum"
options = ["herr", "frau", "firma", "divers"]
label = "labels.mieter.anrede"

[entity.fields.vorname]
type = "string"
max_length = 50
label = "labels.mieter.vorname"
required_if = { field = "anrede", not_in = ["firma"] }

[entity.fields.nachname]
type = "string"
required = true
max_length = 50
label = "labels.mieter.nachname"
description = "Bei Firma: Firmenname"

[entity.fields.firma_zusatz]
type = "string"
max_length = 100
label = "labels.mieter.firma_zusatz"
visible_if = { field = "anrede", equals = "firma" }

[entity.fields.geburtsdatum]
type = "date"
label = "labels.mieter.geburtsdatum"
visible_if = { field = "anrede", not_in = ["firma"] }

[entity.fields.telefon]
type = "string"
max_length = 30
label = "labels.mieter.telefon"

[entity.fields.email]
type = "email"
max_length = 100
label = "labels.mieter.email"

[entity.fields.adresse_vorher]
type = "text"
label = "labels.mieter.adresse_vorher"
description = "Vorherige Anschrift"

[entity.fields.iban]
type = "string"
max_length = 34
pattern = "^[A-Z]{2}[0-9]{2}[A-Z0-9]{1,30}$"
label = "labels.mieter.iban"

[entity.fields.bic]
type = "string"
max_length = 11
label = "labels.mieter.bic"

[entity.fields.bankname]
type = "string"
max_length = 100
label = "labels.mieter.bankname"

[entity.fields.status]
type = "enum"
required = true
options = ["aktiv", "gekuendigt", "ehemalig"]
default = "aktiv"
label = "labels.mieter.status"

[entity.fields.notiz]
type = "text"
label = "labels.common.notiz"

[entity.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false
label = "labels.common.erstellt_am"

[entity.relations]
vertraege = { type = "one_to_many", target = "vertrag", foreign_key = "mieter_id" }
dokumente = { type = "one_to_many", target = "dokument", foreign_key = "mieter_id" }
zahlungen = { type = "one_to_many", target = "zahlung", foreign_key = "mieter_id", through = "vertrag" }

[entity.computed]
display_name = { formula = "concat(vorname, ' ', nachname)" }
aktiver_vertrag = { formula = "first(vertraege where ende is null or ende > now())" }
aktuelle_einheit = { formula = "aktiver_vertrag.einheit" }
