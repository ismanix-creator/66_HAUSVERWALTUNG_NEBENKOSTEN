# =============================================================================
# MIETVERWALTUNG - MASTER CONFIGURATION (Konsolidiert)
# 100% Config-Driven Property Management System
# =============================================================================
# @version: 1.0.0
# @lastModified: 2025-12-18
# @structure: Basis-Config + konsolidierte Entities/Forms/Tables/Views
# @note: Kataloge bleiben in config/catalogs/
#        Labels, Validation, Design bleiben als Imports
# =============================================================================

# =============================================================================
# META - Konfigurationsmetadaten
# =============================================================================
[meta]
version = "0.2.0"
schema_version = "2"
last_modified = "2025-12-19"
environment = "development"
config_format = "toml"

# =============================================================================
# APP - Anwendungseinstellungen
# =============================================================================
[app]
name = "Mietverwaltung"
description = "Private Mietobjekt-Verwaltung"
locale = "de-DE"
currency = "EUR"
timezone = "Europe/Berlin"
date_format = "DD.MM.YYYY"
time_format = "HH:mm"
datetime_format = "DD.MM.YYYY HH:mm"

[app.owner]
name = "Akki Scholze"
address = ""
tax_number = ""
email = ""
phone = ""
iban = ""
bic = ""

[app.defaults]
kuendigungsfrist_monate = 3
kaution_monate = 3
nk_abrechnungsfrist_monate = 12
mieterhoehung_sperrfrist_monate = 15
mahnfrist_tage = 14
zahlungsziel_tage = 14

[app.storage]
dokumente_pfad = "./data/dokumente"
backup_pfad = "./data/backups"
temp_pfad = "./data/temp"
max_upload_size_mb = 25
allowed_file_types = ["pdf", "jpg", "jpeg", "png", "doc", "docx", "xls", "xlsx"]

# =============================================================================
# WIDTHS - Standard Spaltenbreiten für Tabellen (20px Schritte)
# =============================================================================
[widths]
w40 = "40px"
w60 = "60px"
w80 = "80px"
w100 = "100px"
w120 = "120px"
w140 = "140px"
w160 = "160px"
w180 = "180px"
w200 = "200px"
w220 = "220px"
w240 = "240px"
w260 = "260px"
w280 = "280px"
w300 = "300px"
actions = "120px"

# =============================================================================
# BUTTONS - Button-Styling Konfiguration & Universelle Button-Typen
# =============================================================================
[buttons]

# ============ STYLING (TailwindCSS Classes) ============

# Primary Button Style (Standard Add/Create/Submit Buttons)
primary_text_color = "text-primary-600"
primary_hover_color = "text-primary-700"
primary_border = "none"
primary_padding = "px-4 py-2"
primary_font_size = "text-sm"
primary_font_weight = "font-medium"
primary_rounded = "rounded-lg"
primary_transition = "transition-colors"

# Secondary Button Style (Default/Cancel/Close Buttons)
secondary_text_color = "text-gray-700"
secondary_hover_color = "text-gray-900"
secondary_border = "border border-gray-300"
secondary_padding = "px-4 py-2"
secondary_font_size = "text-sm"
secondary_font_weight = "font-medium"
secondary_rounded = "rounded-lg"
secondary_transition = "transition-colors"

# Danger Button Style (Delete/Remove Buttons)
danger_text_color = "text-red-600"
danger_hover_color = "text-red-700"
danger_border = "none"
danger_padding = "px-4 py-2"
danger_font_size = "text-sm"
danger_font_weight = "font-medium"
danger_rounded = "rounded-lg"
danger_transition = "transition-colors"

# Success Button Style (Confirm/Done Buttons)
success_text_color = "text-green-600"
success_hover_color = "text-green-700"
success_border = "none"
success_padding = "px-4 py-2"
success_font_size = "text-sm"
success_font_weight = "font-medium"
success_rounded = "rounded-lg"
success_transition = "transition-colors"

# Disabled State (alle Button-Typen)
disabled_opacity = "disabled:opacity-50"
disabled_cursor = "disabled:cursor-not-allowed"

# ============ UNIVERSELLE BUTTON-TYPEN (Labels + Icons) ============

# Add/Create Button (häufig in Listen-Views)
[buttons.add]
label = "buttons.hinzufuegen"
icon = "Plus"
style = "primary"

# Edit Button (für Inline-Edit oder Modal)
[buttons.edit]
label = "buttons.bearbeiten"
icon = "Pencil"
style = "primary"

# Save/Submit Button (Form-Submission)
[buttons.save]
label = "buttons.speichern"
icon = "Check"
style = "primary"

# Cancel/Abort Button (Form-Abbruch)
[buttons.cancel]
label = "buttons.abbrechen"
icon = "X"
style = "secondary"

# Delete/Remove Button (Lösch-Bestätigung)
[buttons.delete]
label = "buttons.loeschen"
icon = "Trash2"
style = "danger"

# Confirm Button (Allgemeine Bestätigung)
[buttons.confirm]
label = "buttons.bestaetigen"
icon = "Check"
style = "success"

# Close Button (Modal/Dialog schließen)
[buttons.close]
label = "buttons.schliessen"
icon = "X"
style = "secondary"

# Back Button (Zurück navigieren)
[buttons.back]
label = "buttons.zurueck"
icon = "ChevronLeft"
style = "secondary"

# Reset/Clear Button (Form zurücksetzen)
[buttons.reset]
label = "buttons.zuruecksetzen"
icon = "RotateCcw"
style = "secondary"

# Export Button (Daten exportieren)
[buttons.export]
label = "buttons.exportieren"
icon = "Download"
style = "primary"

# Import Button (Daten importieren)
[buttons.import]
label = "buttons.importieren"
icon = "Upload"
style = "primary"

# Print Button (Seite/Bericht drucken)
[buttons.print]
label = "buttons.drucken"
icon = "Printer"
style = "primary"

# Search/Filter Button (Suche/Filter anwenden)
[buttons.search]
label = "buttons.suchen"
icon = "Search"
style = "primary"

# Help Button (Hilfe/Info anzeigen)
[buttons.help]
label = "buttons.hilfe"
icon = "HelpCircle"
style = "secondary"

# Settings Button (Einstellungen öffnen)
[buttons.settings]
label = "buttons.einstellungen"
icon = "Settings"
style = "secondary"

# Refresh/Reload Button (Daten neu laden)
[buttons.refresh]
label = "buttons.aktualisieren"
icon = "RefreshCw"
style = "secondary"

# Next Button (Weiterleitung zum nächsten Schritt)
[buttons.next]
label = "buttons.weiter"
icon = "ChevronRight"
style = "primary"

# Previous Button (Zurück zum vorherigen Schritt)
[buttons.previous]
label = "buttons.zurueck"
icon = "ChevronLeft"
style = "secondary"

# Duplicate/Copy Button (Eintrag duplizieren)
[buttons.duplicate]
label = "buttons.duplizieren"
icon = "Copy"
style = "primary"

# Archive Button (Eintrag archivieren)
[buttons.archive]
label = "buttons.archivieren"
icon = "Archive"
style = "secondary"

# Restore Button (Eintrag wiederherstellen)
[buttons.restore]
label = "buttons.wiederherstellen"
icon = "RotateCcw"
style = "primary"

# Send Button (Nachricht/Email versenden)
[buttons.send]
label = "buttons.versenden"
icon = "Send"
style = "primary"

# Download Button (Datei herunterladen)
[buttons.download]
label = "buttons.herunterladen"
icon = "Download"
style = "primary"

# Upload Button (Datei hochladen)
[buttons.upload]
label = "buttons.hochladen"
icon = "Upload"
style = "primary"

# View Details Button (Details anschauen)
[buttons.view]
label = "buttons.ansehen"
icon = "Eye"
style = "primary"

# Approve Button (Genehmigung erteilen)
[buttons.approve]
label = "buttons.genehmigen"
icon = "Check"
style = "success"

# Reject Button (Ablehnen)
[buttons.reject]
label = "buttons.ablehnen"
icon = "X"
style = "danger"

# Move Button (Verschieben)
[buttons.move]
label = "buttons.verschieben"
icon = "Move"
style = "primary"

# Sort Button (Sortierung ändern)
[buttons.sort]
label = "buttons.sortieren"
icon = "ArrowUpDown"
style = "secondary"

# Filter Button (Filter anwenden)
[buttons.filter]
label = "buttons.filtern"
icon = "Filter"
style = "primary"

# =============================================================================
# DESIGN - Schriftarten, Farben & Styling-Definitionen
# =============================================================================
[design]

[design.typography]
# Schriftart für Zahlenfelder (integer, decimal, currency)
numbers_font_family = "font-mono"
numbers_font_class = "font-mono"

# Schriftart für Text-Felder
text_font_family = "font-sans"
text_font_class = "font-sans"

# Schriftart für Tabellen-Header
table_header_font = "font-semibold"

# Schriftart für Tabellen-Daten
table_data_font = "font-sans"
table_data_numbers_font = "font-mono"

# =============================================================================
# TABLE - Tabellen-Styling, Zebrastreifen & Spacing
# =============================================================================
[table]

# ============ ROW STYLING ============

# Standard Row Styling
row_padding = "px-4 py-3"       # Padding in Datenzellen
row_border = "border-b border-gray-200"
row_height = "48px"             # Feste Zeilenhöhe für konsistentes Layout

# Row Hover State
row_hover_bg = "hover:bg-gray-50"
row_hover_transition = "transition-colors duration-150"

# Header Row (unterschiedlich von Datenzellen)
header_padding = "px-4 py-3"
header_height = "44px"
header_bg = "bg-gray-100"
header_font_weight = "font-semibold"
header_text_color = "text-gray-700"
header_border = "border-b border-gray-300"

# ============ ZEBRASTREIFEN (Alternate Row Colors) ============

# Striped/Zebra Pattern - Visuelle Lesbarkeit verbessern
stripe_enabled = true
stripe_odd_bg = "bg-white"               # Ungerade Zeilen: Weiß
stripe_even_bg = "bg-gray-50"            # Gerade Zeilen: Hellgrau
stripe_transition = "transition-colors"

# Striped mit Hover-Override
stripe_hover_odd_bg = "hover:bg-blue-50"
stripe_hover_even_bg = "hover:bg-blue-50"

# ============ COLUMN SPACING ============

[table.spacing]
first_column_left = "50px"      # Linker Außenabstand erste Spalte
last_column_right = "50px"      # Rechter Außenabstand letzte Spalte
column_gap = "8px"              # Abstand zwischen Spalten
column_padding = "px-2"         # Padding in einzelnen Spalten

# ============ TABLE CONTAINER ============

[table.container]
border = "border border-gray-200"
rounded = "rounded-lg"
overflow = "overflow-hidden"
shadow = "shadow-sm"
background = "bg-white"

# ============ SCROLL & OVERFLOW ============

[table.scroll]
overflow_x = "overflow-x-auto"
scroll_smooth = "scroll-smooth"

# =============================================================================
# SERVER - Server-Konfiguration
# =============================================================================
[server]
host = "127.0.0.1"
port = 3002
cors_origin = "http://localhost:5174"
request_timeout_ms = 30000
max_request_size = "50mb"

[server.api]
base_path = "/api"
enable_swagger = false
enable_graphql = false

[server.static]
directory = "./public"
cache_control = "public, max-age=3600"
enable_compression = true

# =============================================================================
# DATABASE - Datenbank-Einstellungen
# =============================================================================
[database]
type = "sqlite"
path = "./data/database.sqlite"
wal_mode = true
foreign_keys = true
auto_vacuum = "incremental"
busy_timeout_ms = 5000

[database.migrations]
auto_run = true
directory = "./scripts/migrations"

[database.backup]
enabled = true
schedule = "0 3 * * *"
retention_days = 30
directory = "./data/backups"

# =============================================================================
# NAVIGATION - Navigationsstruktur
# =============================================================================
[navigation]
mode = "sidebar"
position = "left"
collapsible = true
default_collapsed = false

[[navigation.items]]
id = "dashboard"
label = "Dashboard"
route = "/dashboard"
icon = "LayoutDashboard"
order = 10

[[navigation.items]]
id = "objekte"
label = "Objekte/Einheiten"
route = "/objekte"
icon = "Building2"
order = 20

[[navigation.items]]
id = "mieter"
label = "Mieter"
route = "/mieter"
icon = "Users"
order = 30

[[navigation.items]]
id = "vertraege"
label = "Vertraege"
route = "/vertraege"
icon = "FileText"
order = 40

[[navigation.items]]
id = "finanzen"
label = "Finanzen"
route = "/finanzen"
icon = "BarChart3"
order = 50

[[navigation.items]]
id = "nebenkosten"
label = "Nebenkosten"
route = "/nebenkosten"
icon = "Receipt"
order = 60

# =============================================================================
# ROUTES - API-Routing
# =============================================================================
[routes]
base = "/api"
version = "v1"
mobile_readonly = true

# =============================================================================
# PAGINATION - Seitennummerierung
# =============================================================================
[pagination]
default_limit = 100
max_limit = 1000
offset_default = 0

# =============================================================================
# SEARCH - Sucheinstellungen
# =============================================================================
[search]
enabled = true
debounce_ms = 300
min_chars = 2
max_results = 50

# =============================================================================
# EXPORT - Export-Einstellungen
# =============================================================================
[export]
formats = ["pdf", "csv", "xlsx"]
max_records = 10000

# =============================================================================
# NOTIFICATIONS - Benachrichtigungen
# =============================================================================
[notifications]
enabled = true
toast_duration_ms = 3000
sound_enabled = false

# =============================================================================
# AUTOSAVE - Automatisches Speichern
# =============================================================================
[autosave]
enabled = true
interval_ms = 30000
debounce_ms = 500

# =============================================================================
# SHORTCUTS - Tastaturkürzel
# =============================================================================
[shortcuts]
enabled = true
overlay_key = "Shift+?"

# =============================================================================
# LOGGING - Logging-Einstellungen
# =============================================================================
[logging]
level = "info"
format = "json"
output = "console"
max_size_mb = 100
retention_days = 7

# =============================================================================
# SECURITY - Sicherheitseinstellungen
# =============================================================================
[security]
rate_limit_enabled = false
rate_limit_window_ms = 60000
rate_limit_max_requests = 100
csrf_protection = false
sql_injection_prevention = true

# =============================================================================
# PERFORMANCE - Performance-Einstellungen
# =============================================================================
[performance]
cache_enabled = true
cache_ttl_seconds = 3600
compression_enabled = true
query_optimization = true

# =============================================================================
# DEBUG - Debug-Einstellungen
# =============================================================================
[debug]
enabled = false
show_query_time = false
show_render_count = false
log_api_calls = false
mock_delay_ms = 0

# =============================================================================
# ENTITIES - Entity-Definitionen (14 Datenmodelle)
# =============================================================================

[entities.dokument]
name = "dokument"
table_name = "dokumente"
label = "entity.dokument"
label_plural = "labels.entity.dokumente"
icon = "File"
primary_key = "id"

[entities.dokument.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.dokument.fields.objekt_id]
type = "uuid"
reference = "objekt"
label = "dokument.objekt"

[entities.dokument.fields.einheit_id]
type = "uuid"
reference = "einheit"
label = "dokument.einheit"

[entities.dokument.fields.mieter_id]
type = "uuid"
reference = "mieter"
label = "dokument.mieter"

[entities.dokument.fields.vertrag_id]
type = "uuid"
reference = "vertrag"
label = "dokument.vertrag"

[entities.dokument.fields.typ]
type = "enum"
required = true
options = ["rechnung", "vertrag", "ausweis", "korrespondenz", "foto", "sonstig"]
default = "sonstig"
label = "dokument.typ"

[entities.dokument.fields.bezeichnung]
type = "string"
required = true
max_length = 200
label = "dokument.bezeichnung"

[entities.dokument.fields.dateiname]
type = "string"
required = true
max_length = 255
label = "dokument.dateiname"

[entities.dokument.fields.dateipfad]
type = "string"
required = true
label = "dokument.dateipfad"

[entities.dokument.fields.dateigroesse]
type = "integer"
label = "dokument.dateigroesse"

[entities.dokument.fields.mime_type]
type = "string"
max_length = 100
label = "dokument.mime_type"

[entities.dokument.fields.datum]
type = "date"
label = "dokument.datum"
description = "Dokumentdatum (z.B. Rechnungsdatum)"

[entities.dokument.fields.jahr]
type = "integer"
label = "dokument.jahr"
description = "Für Steuerberater-Sortierung"

[entities.dokument.fields.hochgeladen_am]
type = "datetime"
auto_generate = true
label = "dokument.hochgeladen_am"

[entities.dokument.relations]
objekt = { type = "many_to_one", target = "objekt", foreign_key = "objekt_id" }
einheit = { type = "many_to_one", target = "einheit", foreign_key = "einheit_id" }
mieter = { type = "many_to_one", target = "mieter", foreign_key = "mieter_id" }
vertrag = { type = "many_to_one", target = "vertrag", foreign_key = "vertrag_id" }

[entities.dokument.validation]
mindestens_eine_zuordnung = { rule = "objekt_id is not null or mieter_id is not null or vertrag_id is not null", message = "labels.validation.dokument_zuordnung" }

[entities.einheit]
name = "einheit"
table_name = "einheiten"
label = "entity.einheit"
label_plural = "labels.entity.einheiten"
icon = "DoorOpen"
primary_key = "id"

[entities.einheit.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.einheit.fields.objekt_id]
type = "uuid"
required = true
reference = "objekt"
label = "einheit.objekt"
placeholder = "Objekt wählen"

[entities.einheit.fields.bezeichnung]
type = "string"
required = true
max_length = 50
label = "einheit.bezeichnung"
placeholder = "z.B. EG links, Halle A"

[entities.einheit.fields.typ]
type = "enum"
required = true
options = ["wohnung", "gewerbe", "stellplatz", "keller", "sonstig"]
default = "wohnung"
label = "einheit.typ"
placeholder = "wohnung"

[entities.einheit.fields.flaeche]
type = "decimal"
required = true
min = 1
precision = 2
suffix = "m²"
label = "einheit.flaeche"
placeholder = "75.0"

[entities.einheit.fields.anzahl_raeume]
type = "decimal"
min = 1
precision = 1
label = "einheit.anzahl_raeume"
visible_if = { field = "typ", in = ["wohnung"] }
placeholder = "3.5"

[entities.einheit.fields.etage]
type = "string"
max_length = 20
label = "einheit.etage"
placeholder = "z.B. EG, 1. OG, DG"

[entities.einheit.fields.ausstattung]
type = "multiselect"
options = ["balkon", "terrasse", "keller", "stellplatz", "einbaukueche", "aufzug", "gaeste_wc"]
label = "einheit.ausstattung"
placeholder = "balkon, keller"

[entities.einheit.fields.status]
type = "enum"
required = true
options = ["vermietet", "leer", "eigennutzung", "renovierung"]
default = "leer"
label = "einheit.status"
placeholder = "leer"

[entities.einheit.fields.notiz]
type = "text"
label = "common.notiz"
placeholder = "Besondere Merkmale, Schlüsselübergabe"

[entities.einheit.relations]
objekt = { type = "many_to_one", target = "objekt", foreign_key = "objekt_id" }
vertraege = { type = "one_to_many", target = "vertrag", foreign_key = "einheit_id" }
zaehler = { type = "one_to_many", target = "zaehler", foreign_key = "einheit_id" }

[entities.einheit.computed]
aktueller_vertrag = { formula = "first(vertraege where ende is null or ende > now())" }
aktueller_mieter = { formula = "aktueller_vertrag.mieter" }

[entities.erinnerung]
name = "erinnerung"
table_name = "erinnerungen"
label = "entity.erinnerung"
label_plural = "labels.entity.erinnerungen"
icon = "Bell"
primary_key = "id"

[entities.erinnerung.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.erinnerung.fields.typ]
type = "enum"
required = true
options = ["mieterhoehung", "vertragsende", "zaehlerablesung", "rueckstand", "nk_abrechnung", "kaution_rueckzahlung", "sonstig"]
label = "erinnerung.typ"

[entities.erinnerung.fields.bezug_typ]
type = "enum"
options = ["vertrag", "objekt", "mieter", "einheit"]
label = "erinnerung.bezug_typ"

[entities.erinnerung.fields.bezug_id]
type = "uuid"
label = "erinnerung.bezug_id"

[entities.erinnerung.fields.faellig_am]
type = "date"
required = true
label = "erinnerung.faellig_am"

[entities.erinnerung.fields.titel]
type = "string"
required = true
max_length = 200
label = "erinnerung.titel"

[entities.erinnerung.fields.beschreibung]
type = "text"
label = "erinnerung.beschreibung"

[entities.erinnerung.fields.status]
type = "enum"
required = true
options = ["offen", "erledigt", "zurueckgestellt"]
default = "offen"
label = "erinnerung.status"

[entities.erinnerung.fields.erstellt_am]
type = "datetime"
auto_generate = true
label = "common.erstellt_am"

[entities.kaution]
name = "kaution"
table_name = "kautionen"
label = "entity.kaution"
label_plural = "labels.entity.kautionen"
icon = "Shield"
primary_key = "id"

[entities.kaution.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.kaution.fields.vertrag_id]
type = "uuid"
required = true
unique = true
reference = "vertrag"
label = "kaution.vertrag"

[entities.kaution.fields.betrag]
type = "currency"
required = true
min = 0
label = "kaution.betrag"

[entities.kaution.fields.eingangsdatum]
type = "date"
required = true
label = "kaution.eingangsdatum"

[entities.kaution.fields.anlageform]
type = "enum"
required = true
options = ["sparbuch", "konto", "buergschaft", "bar"]
default = "konto"
label = "kaution.anlageform"

[entities.kaution.fields.anlage_details]
type = "text"
label = "kaution.anlage_details"
placeholder = "Bank, Kontonummer, etc."

[entities.kaution.fields.zinssatz]
type = "decimal"
min = 0
max = 10
precision = 2
suffix = "%"
label = "kaution.zinssatz"

[entities.kaution.fields.status]
type = "enum"
required = true
options = ["angelegt", "teilrueckzahlung", "zurueckgezahlt"]
default = "angelegt"
label = "kaution.status"

[entities.kaution.fields.rueckzahlungsdatum]
type = "date"
label = "kaution.rueckzahlungsdatum"
visible_if = { field = "status", in = ["teilrueckzahlung", "zurueckgezahlt"] }

[entities.kaution.fields.rueckzahlungsbetrag]
type = "currency"
min = 0
label = "kaution.rueckzahlungsbetrag"
visible_if = { field = "status", in = ["teilrueckzahlung", "zurueckgezahlt"] }

[entities.kaution.fields.einbehalt_grund]
type = "text"
label = "kaution.einbehalt_grund"
visible_if = { field = "status", equals = "teilrueckzahlung" }

[entities.kaution.fields.notiz]
type = "text"
label = "common.notiz"

[entities.kaution.relations]
vertrag = { type = "one_to_one", target = "vertrag", foreign_key = "vertrag_id" }

[entities.kostenart]
name = "kostenart"
table_name = "kostenarten"
label = "entity.kostenart"
label_plural = "labels.entity.kostenarten"
icon = "Tag"
primary_key = "id"

[entities.kostenart.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.kostenart.fields.bezeichnung]
type = "string"
required = true
max_length = 100
label = "kostenart.bezeichnung"

[entities.kostenart.fields.kategorie]
type = "enum"
required = true
options = ["umlagefaehig", "nicht_umlagefaehig"]
default = "umlagefaehig"
label = "kostenart.kategorie"

[entities.kostenart.fields.umlageschluessel]
type = "enum"
required = true
options = ["flaeche", "personen", "einheiten", "verbrauch", "direkt"]
default = "flaeche"
label = "kostenart.umlageschluessel"
description = "direkt = 1:1 Zuordnung zu Einheit"

[entities.kostenart.fields.nur_gewerbe]
type = "boolean"
default = false
label = "kostenart.nur_gewerbe"

[entities.kostenart.fields.sortierung]
type = "integer"
default = 100
label = "kostenart.sortierung"

[entities.kostenart.fields.aktiv]
type = "boolean"
default = true
label = "kostenart.aktiv"

[entities.kostenart.relations]
rechnungen = { type = "one_to_many", target = "rechnung", foreign_key = "kostenart_id" }

[entities.mieter]
name = "mieter"
table_name = "mieter"
label = "entity.mieter"
label_plural = "labels.entity.mieter_plural"
icon = "User"
primary_key = "id"

[entities.mieter.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.mieter.fields.anrede]
type = "enum"
options = ["herr", "frau", "firma", "divers"]
label = "mieter.anrede"
placeholder = "herr"

[entities.mieter.fields.vorname]
type = "string"
max_length = 50
label = "mieter.vorname"
required_if = { field = "anrede", not_in = ["firma"] }
placeholder = "Max"

[entities.mieter.fields.nachname]
type = "string"
required = true
max_length = 50
label = "mieter.nachname"
description = "Bei Firma: Firmenname"
placeholder = "Mustermann"

[entities.mieter.fields.firma_zusatz]
type = "string"
max_length = 100
label = "mieter.firma_zusatz"
visible_if = { field = "anrede", equals = "firma" }
placeholder = "Muster GmbH"

[entities.mieter.fields.geburtsdatum]
type = "date"
label = "mieter.geburtsdatum"
visible_if = { field = "anrede", not_in = ["firma"] }

[entities.mieter.fields.telefon]
type = "string"
max_length = 30
label = "mieter.telefon"
placeholder = "+49 170 1234567"

[entities.mieter.fields.email]
type = "email"
max_length = 100
label = "mieter.email"
placeholder = "max@example.com"

[entities.mieter.fields.adresse_vorher]
type = "text"
label = "mieter.adresse_vorher"
description = "Vorherige Anschrift"
placeholder = "Musterstraße 1, 12345 Berlin"

[entities.mieter.fields.iban]
type = "string"
max_length = 34
pattern = "^[A-Z]{2}[0-9]{2}[A-Z0-9]{1,30}$"
label = "mieter.iban"
default = "DE"
placeholder = "DE12 3456 7890 1234 5678 90"

[entities.mieter.fields.bic]
type = "string"
max_length = 11
label = "mieter.bic"
placeholder = "COBADEFFXXX"

[entities.mieter.fields.bankname]
type = "string"
max_length = 100
label = "mieter.bankname"
placeholder = "Commerzbank Köln"

[entities.mieter.fields.status]
type = "enum"
required = true
options = ["aktiv", "gekuendigt", "ehemalig"]
default = "aktiv"
label = "mieter.status"
placeholder = "aktiv"

[entities.mieter.fields.notiz]
type = "text"
label = "common.notiz"
placeholder = "Hinweise zur Kommunikation"

[entities.mieter.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false
label = "common.erstellt_am"

[entities.mieter.relations]
vertraege = { type = "one_to_many", target = "vertrag", foreign_key = "mieter_id" }
dokumente = { type = "one_to_many", target = "dokument", foreign_key = "mieter_id" }
zahlungen = { type = "one_to_many", target = "zahlung", foreign_key = "mieter_id", through = "vertrag" }

[entities.mieter.computed]
display_name = { formula = "concat(vorname, ' ', nachname)" }
aktiver_vertrag = { formula = "first(vertraege where ende is null or ende > now())" }
aktuelle_einheit = { formula = "aktiver_vertrag.einheit" }

[entities.nebenkostenabrechnung]
name = "nebenkostenabrechnung"
table_name = "nebenkostenabrechnungen"
label = "entity.nebenkostenabrechnung"
label_plural = "labels.entity.nebenkostenabrechnungen"
icon = "FileSpreadsheet"
primary_key = "id"

[entities.nebenkostenabrechnung.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.nebenkostenabrechnung.fields.objekt_id]
type = "uuid"
required = true
reference = "objekt"
label = "nk.objekt"

[entities.nebenkostenabrechnung.fields.jahr]
type = "integer"
required = true
min = 2000
max = 2100
label = "nk.jahr"

[entities.nebenkostenabrechnung.fields.zeitraum_von]
type = "date"
required = true
label = "nk.zeitraum_von"

[entities.nebenkostenabrechnung.fields.zeitraum_bis]
type = "date"
required = true
label = "nk.zeitraum_bis"

[entities.nebenkostenabrechnung.fields.status]
type = "enum"
required = true
options = ["entwurf", "erstellt", "versendet"]
default = "entwurf"
label = "nk.status"

[entities.nebenkostenabrechnung.fields.erstellt_am]
type = "datetime"
auto_generate = true
label = "common.erstellt_am"

[entities.nebenkostenabrechnung.fields.notiz]
type = "text"
label = "common.notiz"

[entities.nebenkostenabrechnung.relations]
objekt = { type = "many_to_one", target = "objekt", foreign_key = "objekt_id" }
positionen = { type = "one_to_many", target = "nebenkostenabrechnung_position", foreign_key = "abrechnung_id" }

[entities.nebenkostenabrechnung.computed]
gesamtkosten = { formula = "sum(positionen.gesamtkosten)" }

[entities.objekt]
name = "objekt"
table_name = "objekte"
label = "entity.objekt"
label_plural = "labels.entity.objekte"
icon = "Building2"
primary_key = "id"

[entities.objekt.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.objekt.fields.bezeichnung]
type = "string"
required = true
max_length = 100
label = "objekt.bezeichnung"
placeholder = "z.B. Haus Musterstraße 12"

[entities.objekt.fields.adresse]
type = "string"
required = true
max_length = 200
label = "objekt.adresse"

[entities.objekt.fields.plz]
type = "string"
required = true
pattern = "^[0-9]{5}$"
label = "objekt.plz"

[entities.objekt.fields.ort]
type = "string"
required = true
max_length = 100
label = "objekt.ort"

[entities.objekt.fields.baujahr]
type = "integer"
min = 1800
max = 2100
label = "objekt.baujahr"

[entities.objekt.fields.typ]
type = "enum"
required = true
options = ["wohnraum", "gewerbe", "gemischt"]
default = "wohnraum"
label = "objekt.typ"

[entities.objekt.fields.ist_multi_einheit]
type = "boolean"
default = false
label = "objekt.ist_multi_einheit"
description = "Mehrere Einheiten mit separaten Zählern"

[entities.objekt.fields.notiz]
type = "text"
label = "common.notiz"

[entities.objekt.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false
label = "common.erstellt_am"

[entities.objekt.relations]
einheiten = { type = "one_to_many", target = "einheit", foreign_key = "objekt_id" }
zaehler = { type = "one_to_many", target = "zaehler", foreign_key = "objekt_id" }
rechnungen = { type = "one_to_many", target = "rechnung", foreign_key = "objekt_id" }
dokumente = { type = "one_to_many", target = "dokument", foreign_key = "objekt_id" }

[entities.objekt.computed]
anzahl_einheiten = { formula = "count(einheiten)" }
anzahl_vermietet = { formula = "count(einheiten where status = 'vermietet')" }
leerstand = { formula = "anzahl_einheiten - anzahl_vermietet" }
gesamt_flaeche = { formula = "sum(einheiten.flaeche)" }

[entities.rechnung]
name = "rechnung"
table_name = "rechnungen"
label = "entity.rechnung"
label_plural = "labels.entity.rechnungen"
icon = "Receipt"
primary_key = "id"

[entities.rechnung.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.rechnung.fields.objekt_id]
type = "uuid"
required = true
reference = "objekt"
label = "rechnung.objekt"

[entities.rechnung.fields.kostenart_id]
type = "uuid"
required = true
reference = "kostenart"
label = "rechnung.kostenart"

[entities.rechnung.fields.einheit_id]
type = "uuid"
reference = "einheit"
label = "rechnung.einheit"
description = "Nur bei Direktzuordnung"
visible_if = { field = "kostenart.umlageschluessel", equals = "direkt" }

[entities.rechnung.fields.rechnungsnummer]
type = "string"
max_length = 50
label = "rechnung.rechnungsnummer"

[entities.rechnung.fields.rechnungsdatum]
type = "date"
required = true
label = "rechnung.rechnungsdatum"

[entities.rechnung.fields.faelligkeitsdatum]
type = "date"
label = "rechnung.faelligkeitsdatum"

[entities.rechnung.fields.betrag]
type = "currency"
required = true
min = 0
label = "rechnung.betrag"

[entities.rechnung.fields.zeitraum_von]
type = "date"
label = "rechnung.zeitraum_von"

[entities.rechnung.fields.zeitraum_bis]
type = "date"
label = "rechnung.zeitraum_bis"

[entities.rechnung.fields.bezahlt_am]
type = "date"
label = "rechnung.bezahlt_am"

[entities.rechnung.fields.dokument_id]
type = "uuid"
reference = "dokument"
label = "rechnung.dokument"

[entities.rechnung.fields.notiz]
type = "text"
label = "common.notiz"

[entities.rechnung.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false

[entities.rechnung.relations]
objekt = { type = "many_to_one", target = "objekt", foreign_key = "objekt_id" }
kostenart = { type = "many_to_one", target = "kostenart", foreign_key = "kostenart_id" }
einheit = { type = "many_to_one", target = "einheit", foreign_key = "einheit_id" }
dokument = { type = "many_to_one", target = "dokument", foreign_key = "dokument_id" }

[entities.rechnung.computed]
ist_bezahlt = { formula = "bezahlt_am is not null" }
jahr = { formula = "year(rechnungsdatum)" }

[entities.sollstellung]
name = "sollstellung"
table_name = "sollstellungen"
label = "entity.sollstellung"
label_plural = "labels.entity.sollstellungen"
icon = "ListChecks"
primary_key = "id"

[entities.sollstellung.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.sollstellung.fields.vertrag_id]
type = "uuid"
required = true
reference = "vertrag"
label = "sollstellung.vertrag"

[entities.sollstellung.fields.monat]
type = "string"
required = true
pattern = "^[0-9]{4}-[0-9]{2}$"
label = "sollstellung.monat"

[entities.sollstellung.fields.sollbetrag]
type = "currency"
required = true
label = "sollstellung.sollbetrag"

[entities.sollstellung.fields.istbetrag]
type = "currency"
default = 0
label = "sollstellung.istbetrag"

[entities.sollstellung.fields.status]
type = "enum"
options = ["offen", "teilweise", "bezahlt", "ueberzahlt"]
default = "offen"
label = "sollstellung.status"

[entities.sollstellung.relations]
vertrag = { type = "many_to_one", target = "vertrag", foreign_key = "vertrag_id" }

[entities.sollstellung.computed]
differenz = { formula = "istbetrag - sollbetrag" }
mieter = { formula = "vertrag.mieter" }

[entities.vertrag]
name = "vertrag"
table_name = "vertraege"
label = "entity.vertrag"
label_plural = "labels.entity.vertraege"
icon = "FileSignature"
primary_key = "id"

[entities.vertrag.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.vertrag.fields.einheit_id]
type = "uuid"
required = true
reference = "einheit"
label = "vertrag.einheit"

[entities.vertrag.fields.mieter_id]
type = "uuid"
required = true
reference = "mieter"
label = "vertrag.mieter"

[entities.vertrag.fields.vertragsnummer]
type = "string"
max_length = 30
label = "vertrag.vertragsnummer"

[entities.vertrag.fields.typ]
type = "enum"
required = true
options = ["wohnraum", "gewerbe"]
label = "vertrag.typ"
auto_from = "einheit.objekt.typ"

[entities.vertrag.fields.beginn]
type = "date"
required = true
label = "vertrag.beginn"

[entities.vertrag.fields.ende]
type = "date"
label = "vertrag.ende"
description = "Leer = unbefristet"

[entities.vertrag.fields.kuendigungsfrist]
type = "integer"
default = 3
min = 1
max = 12
suffix = "Monate"
label = "vertrag.kuendigungsfrist"

[entities.vertrag.fields.kuendigung_zum]
type = "date"
label = "vertrag.kuendigung_zum"

[entities.vertrag.fields.gekuendigt_von]
type = "enum"
options = ["mieter", "vermieter"]
label = "vertrag.gekuendigt_von"
visible_if = { field = "kuendigung_zum", is_set = true }

# === Mietkonditionen ===

[entities.vertrag.fields.kaltmiete]
type = "currency"
required = true
min = 0
label = "vertrag.kaltmiete"

[entities.vertrag.fields.nebenkosten_vorauszahlung]
type = "currency"
required = true
min = 0
default = 0
label = "vertrag.nebenkosten_vorauszahlung"

[entities.vertrag.fields.heizkosten_vorauszahlung]
type = "currency"
min = 0
default = 0
label = "vertrag.heizkosten_vorauszahlung"

[entities.vertrag.fields.sonstige_vorauszahlung]
type = "currency"
min = 0
default = 0
label = "vertrag.sonstige_vorauszahlung"
description = "z.B. Stellplatz, Garage"

# === Mieterhöhung ===

[entities.vertrag.fields.mietanpassung_typ]
type = "enum"
options = ["keine", "mietspiegel", "staffel", "index"]
default = "mietspiegel"
label = "vertrag.mietanpassung_typ"
visible_if = { field = "typ", equals = "wohnraum" }

[entities.vertrag.fields.staffelmiete]
type = "json"
label = "vertrag.staffelmiete"
description = "Array: [{ab: date, kaltmiete: number}]"
visible_if = { field = "mietanpassung_typ", equals = "staffel" }

[entities.vertrag.fields.indexmiete]
type = "json"
label = "vertrag.indexmiete"
description = "{basisjahr, basisindex, schwelle_prozent}"
visible_if = { field = "mietanpassung_typ", equals = "index" }

[entities.vertrag.fields.letzte_mieterhoehung]
type = "date"
label = "vertrag.letzte_mieterhoehung"

[entities.vertrag.fields.notiz]
type = "text"
label = "common.notiz"

[entities.vertrag.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false

[entities.vertrag.relations]
einheit = { type = "many_to_one", target = "einheit", foreign_key = "einheit_id" }
mieter = { type = "many_to_one", target = "mieter", foreign_key = "mieter_id" }
kaution = { type = "one_to_one", target = "kaution", foreign_key = "vertrag_id" }
zahlungen = { type = "one_to_many", target = "zahlung", foreign_key = "vertrag_id" }
sollstellungen = { type = "one_to_many", target = "sollstellung", foreign_key = "vertrag_id" }

[entities.vertrag.computed]
gesamtmiete = { formula = "kaltmiete + nebenkosten_vorauszahlung + heizkosten_vorauszahlung + sonstige_vorauszahlung" }
ist_aktiv = { formula = "(ende is null or ende > now()) and kuendigung_zum is null" }
ist_gekuendigt = { formula = "kuendigung_zum is not null" }
naechste_mieterhoehung_moeglich = { formula = "add_months(letzte_mieterhoehung, 15)" }

[entities.vertrag.validation]
ende_nach_beginn = { rule = "ende is null or ende > beginn", message = "labels.validation.ende_nach_beginn" }
kuendigung_logik = { rule = "kuendigung_zum is null or gekuendigt_von is not null", message = "labels.validation.kuendigung_von_fehlt" }

[entities.zaehler]
name = "zaehler"
table_name = "zaehler"
label = "entity.zaehler"
label_plural = "labels.entity.zaehler_plural"
icon = "Gauge"
primary_key = "id"

[entities.zaehler.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.zaehler.fields.objekt_id]
type = "uuid"
required = true
reference = "objekt"
label = "zaehler.objekt"

[entities.zaehler.fields.einheit_id]
type = "uuid"
reference = "einheit"
label = "zaehler.einheit"
description = "Leer = Hauptzähler"

[entities.zaehler.fields.typ]
type = "enum"
required = true
options = ["strom", "gas", "wasser", "heizung", "warmwasser"]
label = "zaehler.typ"

[entities.zaehler.fields.zaehlernummer]
type = "string"
required = true
max_length = 50
label = "zaehler.zaehlernummer"

[entities.zaehler.fields.ist_hauptzaehler]
type = "boolean"
default = false
label = "zaehler.ist_hauptzaehler"

[entities.zaehler.fields.messeinheit]
type = "enum"
required = true
options = ["kWh", "m3"]
label = "zaehler.messeinheit"
auto_from_typ = { strom = "kWh", gas = "m3", wasser = "m3", heizung = "kWh", warmwasser = "m3" }

[entities.zaehler.fields.notiz]
type = "text"
label = "common.notiz"

[entities.zaehler.relations]
objekt = { type = "many_to_one", target = "objekt", foreign_key = "objekt_id" }
einheit = { type = "many_to_one", target = "einheit", foreign_key = "einheit_id" }
staende = { type = "one_to_many", target = "zaehlerstand", foreign_key = "zaehler_id" }

[entities.zaehler.computed]
letzter_stand = { formula = "last(staende order by datum)" }
bezeichnung_display = { formula = "concat(typ, ' - ', zaehlernummer, ist_hauptzaehler ? ' (Haupt)' : '')" }

[entities.zaehlerstand]
name = "zaehlerstand"
table_name = "zaehlerstaende"
label = "entity.zaehlerstand"
label_plural = "labels.entity.zaehlerstaende"
icon = "Activity"
primary_key = "id"

[entities.zaehlerstand.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.zaehlerstand.fields.zaehler_id]
type = "uuid"
required = true
reference = "zaehler"
label = "zaehlerstand.zaehler"
visible_in_form = false

[entities.zaehlerstand.fields.datum]
type = "date"
required = true
label = "zaehlerstand.datum"

[entities.zaehlerstand.fields.stand]
type = "decimal"
required = true
min = 0
precision = 2
label = "zaehlerstand.stand"

[entities.zaehlerstand.fields.ableseart]
type = "enum"
required = true
options = ["selbst", "versorger", "schaetzung"]
default = "selbst"
label = "zaehlerstand.ableseart"

[entities.zaehlerstand.fields.foto]
type = "file"
accept = ["image/jpeg", "image/png"]
label = "zaehlerstand.foto"

[entities.zaehlerstand.fields.notiz]
type = "text"
label = "common.notiz"

[entities.zaehlerstand.relations]
zaehler = { type = "many_to_one", target = "zaehler", foreign_key = "zaehler_id" }

[entities.zaehlerstand.computed]
verbrauch = { formula = "stand - previous(stand)" }

[entities.zahlung]
name = "zahlung"
table_name = "zahlungen"
label = "entity.zahlung"
label_plural = "labels.entity.zahlungen"
icon = "ArrowDownCircle"
primary_key = "id"

[entities.zahlung.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.zahlung.fields.vertrag_id]
type = "uuid"
required = true
reference = "vertrag"
label = "zahlung.vertrag"

[entities.zahlung.fields.datum]
type = "date"
required = true
label = "zahlung.datum"

[entities.zahlung.fields.betrag]
type = "currency"
required = true
label = "zahlung.betrag"

[entities.zahlung.fields.verwendungszweck]
type = "string"
max_length = 200
label = "zahlung.verwendungszweck"

[entities.zahlung.fields.typ]
type = "enum"
required = true
options = ["miete", "nachzahlung", "kaution", "sonstig"]
default = "miete"
label = "zahlung.typ"

[entities.zahlung.fields.monat_fuer]
type = "string"
pattern = "^[0-9]{4}-[0-9]{2}$"
label = "zahlung.monat_fuer"
placeholder = "YYYY-MM"
visible_if = { field = "typ", equals = "miete" }

[entities.zahlung.fields.notiz]
type = "text"
label = "common.notiz"

[entities.zahlung.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false

[entities.zahlung.relations]
vertrag = { type = "many_to_one", target = "vertrag", foreign_key = "vertrag_id" }

[entities.zahlung.computed]
mieter = { formula = "vertrag.mieter" }
einheit = { formula = "vertrag.einheit" }

# =============================================================================
# FORMS - Formular-Definitionen
# =============================================================================

[forms.dokument.form]
entity = "dokument"
title_create = "labels.form.dokument_hochladen"
title_edit = "labels.form.dokument_bearbeiten"

[[forms.dokument.form.sections]]
id = "zuordnung"
label = "labels.form.section.zuordnung"

  [[forms.dokument.form.sections.fields]]
  field = "objekt_id"
  width = "half"
  allow_clear = true

  [[forms.dokument.form.sections.fields]]
  field = "einheit_id"
  width = "half"
  allow_clear = true

  [[forms.dokument.form.sections.fields]]
  field = "mieter_id"
  width = "half"
  allow_clear = true

  [[forms.dokument.form.sections.fields]]
  field = "vertrag_id"
  width = "half"
  allow_clear = true

[[forms.dokument.form.sections]]
id = "detail"
label = "labels.form.section.details"

  [[forms.dokument.form.sections.fields]]
  field = "typ"
  width = "half"

  [[forms.dokument.form.sections.fields]]
  field = "bezeichnung"
  width = "half"

  [[forms.dokument.form.sections.fields]]
  field = "datum"
  width = "third"

  [[forms.dokument.form.sections.fields]]
  field = "jahr"
  width = "third"

  [[forms.dokument.form.sections.fields]]
  field = "hochgeladen_am"
  width = "third"
  readonly = true

[[forms.dokument.form.sections]]
id = "datei"
label = "labels.form.section.datei"

  [[forms.dokument.form.sections.fields]]
  field = "dateiname"
  width = "half"

  [[forms.dokument.form.sections.fields]]
  field = "dateipfad"
  width = "half"
  readonly = true

  [[forms.dokument.form.sections.fields]]
  field = "dateigroesse"
  width = "half"
  readonly = true

  [[forms.dokument.form.sections.fields]]
  field = "mime_type"
  width = "half"
  readonly = true

[[forms.dokument.form.sections]]
id = "notiz"

  [[forms.dokument.form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.dokument.form.actions]
save_label = "actions.speichern"
cancel_label = "actions.abbrechen"

[forms.einheit.form]
entity = "einheit"
title_create = "labels.actions.add"
title_edit = "labels.actions.edit"

[[forms.einheit.form.sections]]
id = "basis"
label = "labels.form.section.basic"

  [[forms.einheit.form.sections.fields]]
  field = "objekt_id"
  width = "full"

  [[forms.einheit.form.sections.fields]]
  field = "bezeichnung"
  width = "half"

  [[forms.einheit.form.sections.fields]]
  field = "typ"
  width = "half"

[[forms.einheit.form.sections]]
id = "details"
label = "labels.form.section.details"

  [[forms.einheit.form.sections.fields]]
  field = "flaeche"
  width = "half"

  [[forms.einheit.form.sections.fields]]
  field = "anzahl_raeume"
  width = "half"

  [[forms.einheit.form.sections.fields]]
  field = "etage"
  placeholder = "2. OG"
  width = "half"

[[forms.einheit.form.sections]]
id = "ausstattung"
label = "labels.form.section.settings"

  [[forms.einheit.form.sections.fields]]
  field = "ausstattung"
  width = "full"

  [[forms.einheit.form.sections.fields]]
  field = "status"
  width = "half"

[[forms.einheit.form.sections]]
id = "notizen"
label = "labels.form.section.notes"

  [[forms.einheit.form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.einheit.form.actions]
submit = "buttons.save"
cancel = "buttons.cancel"

[forms.kaution.form]
entity = "kaution"
title_create = "labels.form.kaution_anlegen"
title_edit = "labels.form.kaution_bearbeiten"

[[forms.kaution.form.sections]]
id = "daten"
label = "labels.form.section.allgemein"

  [[forms.kaution.form.sections.fields]]
  field = "vertrag_id"
  width = "full"

  [[forms.kaution.form.sections.fields]]
  field = "betrag"
  width = "half"

  [[forms.kaution.form.sections.fields]]
  field = "eingangsdatum"
  width = "half"

  [[forms.kaution.form.sections.fields]]
  field = "anlageform"
  width = "full"

[[forms.kaution.form.sections]]
id = "details"
label = "labels.form.section.kaution"

  [[forms.kaution.form.sections.fields]]
  field = "anlage_details"
  width = "full"
  rows = 2

  [[forms.kaution.form.sections.fields]]
  field = "zinssatz"
  width = "half"

  [[forms.kaution.form.sections.fields]]
  field = "status"
  width = "half"

  [[forms.kaution.form.sections.fields]]
  field = "rueckzahlungsdatum"
  width = "half"

  [[forms.kaution.form.sections.fields]]
  field = "rueckzahlungsbetrag"
  width = "half"

  [[forms.kaution.form.sections.fields]]
  field = "einbehalt_grund"
  width = "full"
  rows = 2

[forms.mieter.form]
entity = "mieter"
title_create = "labels.actions.add"
title_edit = "labels.actions.edit"

[[forms.mieter.form.sections]]
id = "basis"
label = "labels.form.section.basic"

  [[forms.mieter.form.sections.fields]]
  field = "anrede"
  width = "half"

  [[forms.mieter.form.sections.fields]]
  field = "vorname"
  width = "half"

  [[forms.mieter.form.sections.fields]]
  field = "nachname"
  width = "full"

  [[forms.mieter.form.sections.fields]]
  field = "firma_zusatz"
  width = "full"

[[forms.mieter.form.sections]]
id = "kontakt"
label = "labels.form.section.contact"

  [[forms.mieter.form.sections.fields]]
  field = "email"
  width = "full"

  [[forms.mieter.form.sections.fields]]
  field = "telefon"
  width = "half"

  [[forms.mieter.form.sections.fields]]
  field = "mobil"
  width = "half"

  [[forms.mieter.form.sections.fields]]
  field = "status"
  width = "half"

[[forms.mieter.form.sections]]
id = "adressen"
label = "labels.form.section.addresses"

  [[forms.mieter.form.sections.fields]]
  field = "adresse_vorher"
  width = "full"

[[forms.mieter.form.sections]]
id = "banking"
label = "labels.form.section.financial"

  [[forms.mieter.form.sections.fields]]
  field = "iban"
  width = "full"

  [[forms.mieter.form.sections.fields]]
  field = "bic"
  width = "half"

  [[forms.mieter.form.sections.fields]]
  field = "bankname"
  width = "half"

[[forms.mieter.form.sections]]
id = "notizen"
label = "labels.form.section.notes"

  [[forms.mieter.form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.mieter.form.actions]
submit = { label = "buttons.save" }
cancel = { label = "buttons.cancel" }

[forms.nebenkostenabrechnung.form]
entity = "nebenkostenabrechnung"
title_create = "labels.form.nk_abrechnung_erstellen"
title_edit = "labels.form.nk_abrechnung_bearbeiten"

[[forms.nebenkostenabrechnung.form.sections]]
id = "basis"
label = "labels.form.section.nk_abrechnung"

  [[forms.nebenkostenabrechnung.form.sections.fields]]
  field = "objekt_id"
  width = "full"

  [[forms.nebenkostenabrechnung.form.sections.fields]]
  field = "jahr"
  width = "half"

  [[forms.nebenkostenabrechnung.form.sections.fields]]
  field = "zeitraum_von"
  width = "half"

  [[forms.nebenkostenabrechnung.form.sections.fields]]
  field = "zeitraum_bis"
  width = "half"

  [[forms.nebenkostenabrechnung.form.sections.fields]]
  field = "status"
  width = "half"

[[forms.nebenkostenabrechnung.form.sections]]
id = "notiz"
label = "labels.form.section.notizen"

  [[forms.nebenkostenabrechnung.form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.objekt.form]
entity = "objekt"
title_create = "labels.form.objekt_anlegen"
title_edit = "labels.form.objekt_bearbeiten"

[[forms.objekt.form.sections]]
id = "basis"
label = "labels.form.section.basis"

  [[forms.objekt.form.sections.fields]]
  field = "bezeichnung"
  width = "full"

  [[forms.objekt.form.sections.fields]]
  field = "typ"
  width = "half"

  [[forms.objekt.form.sections.fields]]
  field = "ist_multi_einheit"
  width = "half"

[[forms.objekt.form.sections]]
id = "adresse"
label = "labels.form.section.adresse"

  [[forms.objekt.form.sections.fields]]
  field = "adresse"
  width = "full"

  [[forms.objekt.form.sections.fields]]
  field = "plz"
  width = "third"

  [[forms.objekt.form.sections.fields]]
  field = "ort"
  width = "two_thirds"

[[forms.objekt.form.sections]]
id = "details"
label = "labels.form.section.details"

  [[forms.objekt.form.sections.fields]]
  field = "baujahr"
  width = "half"

  [[forms.objekt.form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.objekt.form.actions]
submit = "buttons.save"
cancel = "buttons.cancel"

[forms.rechnung.form]
entity = "rechnung"
title_create = "labels.form.rechnung_erfassen"
title_edit = "labels.form.rechnung_bearbeiten"

[[forms.rechnung.form.sections]]
id = "metadata"
label = "labels.form.section.rechnung"

  [[forms.rechnung.form.sections.fields]]
  field = "objekt_id"
  width = "full"

  [[forms.rechnung.form.sections.fields]]
  field = "kostenart_id"
  width = "full"

  [[forms.rechnung.form.sections.fields]]
  field = "einheit_id"
  width = "full"

[[forms.rechnung.form.sections]]
id = "zeiträume"
label = "labels.form.section.zeitraum"

  [[forms.rechnung.form.sections.fields]]
  field = "rechnungsnummer"
  width = "half"

  [[forms.rechnung.form.sections.fields]]
  field = "rechnungsdatum"
  width = "half"

  [[forms.rechnung.form.sections.fields]]
  field = "faelligkeitsdatum"
  width = "half"

  [[forms.rechnung.form.sections.fields]]
  field = "zeitraum_von"
  width = "half"

  [[forms.rechnung.form.sections.fields]]
  field = "zeitraum_bis"
  width = "half"

[[forms.rechnung.form.sections]]
id = "betrag"
label = "labels.form.section.betrag"

  [[forms.rechnung.form.sections.fields]]
  field = "betrag"
  width = "half"

  [[forms.rechnung.form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.sollstellung.form]
entity = "sollstellung"
title_create = "labels.form.sollstellung_anlegen"
title_edit = "labels.form.sollstellung_bearbeiten"

[[forms.sollstellung.form.sections]]
id = "zeitraum"
label = "labels.form.section.sollstellung"

  [[forms.sollstellung.form.sections.fields]]
  field = "vertrag_id"
  width = "full"

  [[forms.sollstellung.form.sections.fields]]
  field = "monat"
  width = "half"

  [[forms.sollstellung.form.sections.fields]]
  field = "sollbetrag"
  width = "half"

  [[forms.sollstellung.form.sections.fields]]
  field = "istbetrag"
  width = "half"

  [[forms.sollstellung.form.sections.fields]]
  field = "status"
  width = "half"

[forms.vertrag.form]
entity = "vertrag"
title_create = "labels.form.vertrag_anlegen"
title_edit = "labels.form.vertrag_bearbeiten"

[[forms.vertrag.form.sections]]
id = "zuordnung"
label = "labels.form.section.zuordnung"

  [[forms.vertrag.form.sections.fields]]
  field = "einheit_id"
  width = "half"
  filter = { status = "leer" }
  include_current = true

  [[forms.vertrag.form.sections.fields]]
  field = "mieter_id"
  width = "half"
  allow_create = true

  [[forms.vertrag.form.sections.fields]]
  field = "vertragsnummer"
  width = "half"

  [[forms.vertrag.form.sections.fields]]
  field = "typ"
  width = "half"

[[forms.vertrag.form.sections]]
id = "laufzeit"
label = "labels.form.section.laufzeit"

  [[forms.vertrag.form.sections.fields]]
  field = "beginn"
  width = "third"

  [[forms.vertrag.form.sections.fields]]
  field = "ende"
  width = "third"

  [[forms.vertrag.form.sections.fields]]
  field = "kuendigungsfrist"
  width = "third"

[[forms.vertrag.form.sections]]
id = "miete"
label = "labels.form.section.miete"

  [[forms.vertrag.form.sections.fields]]
  field = "kaltmiete"
  width = "half"

  [[forms.vertrag.form.sections.fields]]
  field = "nebenkosten_vorauszahlung"
  width = "half"

  [[forms.vertrag.form.sections.fields]]
  field = "heizkosten_vorauszahlung"
  width = "half"

  [[forms.vertrag.form.sections.fields]]
  field = "sonstige_vorauszahlung"
  width = "half"

  [form.sections.computed_display]
  field = "computed.gesamtmiete"
  label = "vertrag.gesamtmiete"
  format = "currency"
  highlight = true

[[forms.vertrag.form.sections]]
id = "anpassung"
label = "labels.form.section.mietanpassung"
collapsible = true

  [[forms.vertrag.form.sections.fields]]
  field = "mietanpassung_typ"
  width = "half"

  [[forms.vertrag.form.sections.fields]]
  field = "letzte_mieterhoehung"
  width = "half"

  [[forms.vertrag.form.sections.fields]]
  field = "staffelmiete"
  width = "full"
  component = "StaffelmieteEditor"

  [[forms.vertrag.form.sections.fields]]
  field = "indexmiete"
  width = "full"
  component = "IndexmieteEditor"

[[forms.vertrag.form.sections]]
id = "sonstiges"

  [[forms.vertrag.form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.vertrag.form.on_save]
actions = [
  { action = "update_einheit_status", target = "einheit_id", set = { status = "vermietet" } },
  { action = "update_mieter_status", target = "mieter_id", set = { status = "aktiv" } },
  { action = "generate_sollstellungen", from = "beginn" }
]

[forms.zaehler.form]
entity = "zaehler"
title_create = "labels.form.zaehler_anlegen"
title_edit = "labels.form.zaehler_bearbeiten"

[[forms.zaehler.form.sections]]
id = "zuordnung"
label = "labels.form.section.zaehler_zuordnung"

  [[forms.zaehler.form.sections.fields]]
  field = "objekt_id"
  width = "full"

  [[forms.zaehler.form.sections.fields]]
  field = "einheit_id"
  width = "full"
  description = "Nur für Unterzähler"

[[forms.zaehler.form.sections]]
id = "details"
label = "labels.form.section.zaehler_details"

  [[forms.zaehler.form.sections.fields]]
  field = "typ"
  width = "half"

  [[forms.zaehler.form.sections.fields]]
  field = "messeinheit"
  width = "half"

  [[forms.zaehler.form.sections.fields]]
  field = "zaehlernummer"
  width = "half"

  [[forms.zaehler.form.sections.fields]]
  field = "ist_hauptzaehler"
  width = "half"

[[forms.zaehler.form.sections]]
id = "zusatz"
label = "labels.form.section.zaehler_zusatz"

  [[forms.zaehler.form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.zaehlerstand.form]
entity = "zaehlerstand"
title_create = "labels.form.zaehlerstand_erfassen"
title_edit = "labels.form.zaehlerstand_bearbeiten"

[[forms.zaehlerstand.form.sections]]
id = "basis"
label = "labels.form.section.zaehlerstand"

  [[forms.zaehlerstand.form.sections.fields]]
  field = "zaehler_id"
  width = "full"
  hidden = true

  [[forms.zaehlerstand.form.sections.fields]]
  field = "datum"
  width = "half"

  [[forms.zaehlerstand.form.sections.fields]]
  field = "stand"
  width = "half"

  [[forms.zaehlerstand.form.sections.fields]]
  field = "ableseart"
  width = "half"

  [[forms.zaehlerstand.form.sections.fields]]
  field = "foto"
  width = "half"

  [[forms.zaehlerstand.form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.zahlung.form]
entity = "zahlung"
title_create = "labels.form.zahlung_erfassen"
title_edit = "labels.form.zahlung_bearbeiten"

[[forms.zahlung.form.sections]]
id = "basis"
label = "labels.form.section.zahlung"

  [[forms.zahlung.form.sections.fields]]
  field = "vertrag_id"
  width = "full"

  [[forms.zahlung.form.sections.fields]]
  field = "datum"
  width = "half"

  [[forms.zahlung.form.sections.fields]]
  field = "betrag"
  width = "half"

  [[forms.zahlung.form.sections.fields]]
  field = "typ"
  width = "half"

  [[forms.zahlung.form.sections.fields]]
  field = "monat_fuer"
  width = "half"

  [[forms.zahlung.form.sections.fields]]
  field = "verwendungszweck"
  width = "full"
  rows = 2

  [[forms.zahlung.form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 2

# =============================================================================
# TABLES - Tabellen-Definitionen
# =============================================================================

[tables.abrechnungen.table]
entity = "nebenkostenabrechnung"

[[tables.abrechnungen.table.columns]]
field = "objekt.bezeichnung"
label = "nk.objekt"
sortable = true
width = "width.w260"

[[tables.abrechnungen.table.columns]]
field = "jahr"
label = "nk.jahr"
sortable = true
width = "width.w160"

[[tables.abrechnungen.table.columns]]
field = "zeitraum_von"
label = "nk.zeitraum"
width = "width.w200"
template = "{zeitraum_von|date} – {zeitraum_bis|date}"

[[tables.abrechnungen.table.columns]]
field = "status"
label = "nk.status"
width = "width.w180"
display = "badge"

[[tables.abrechnungen.table.columns]]
field = "gesamtkosten"
label = "nk.gesamtkosten"
width = "width.w180"
format = "currency"

[tables.abrechnungen.table.actions]
label = "abrechnungen.aktionen"
width = "width.actions"

[tables.abrechnungen.table.row_actions]
details = { icon = "Search", dialog = "dialogs/nk_abrechnung_detail" }

[tables.dokumente.table]
entity = "dokument"
selectable = true

[[tables.dokumente.table.columns]]
field = "bezeichnung"
label = "dokument.bezeichnung"
sortable = true
width = "width.w300"

[[tables.dokumente.table.columns]]
field = "typ"
label = "dokument.typ"
sortable = true
width = "width.w120"
display = "badge"

[[tables.dokumente.table.columns]]
field = "objekt.bezeichnung"
label = "dokument.objekt"
sortable = true
width = "width.w180"
empty_text = "—"

[[tables.dokumente.table.columns]]
field = "mieter.computed.display_name"
label = "dokument.mieter"
width = "width.w180"
empty_text = "—"

[[tables.dokumente.table.columns]]
field = "datum"
label = "dokument.datum"
sortable = true
width = "width.w120"
format = "date"

[[tables.dokumente.table.columns]]
field = "jahr"
label = "dokument.jahr"
sortable = true
width = "width.w100"

[[tables.dokumente.table.columns]]
field = "hochgeladen_am"
label = "dokument.hochgeladen"
sortable = true
width = "width.w160"
format = "datetime"

[tables.dokument.table.actions]
label = "dokument.aktionen"
width = "width.actions"

[tables.dokumente.table.row_actions]
preview = { icon = "Eye", handler = "dokument.preview" }
download = { icon = "Download", handler = "dokument.download" }
edit = { icon = "Pencil", dialog = "forms/dokument.form" }
delete = { icon = "Trash2", confirm = true }

[tables.einheiten.table]
entity = "einheit"
row_click = "expand"

[[tables.einheiten.table.columns]]
field = "bezeichnung"
label = "einheit.bezeichnung"
sortable = true
width = "width.w300"

[[tables.einheiten.table.columns]]
field = "typ"
label = "einheit.typ"
sortable = true
width = "width.w180"
display = "badge"

[[tables.einheiten.table.columns]]
field = "flaeche"
label = "einheit.flaeche"
sortable = true
width = "width.w120"
format = "number"
suffix = " m²"

[[tables.einheiten.table.columns]]
field = "computed.aktueller_mieter.computed.display_name"
label = "einheit.mieter"
width = "width.w300"
empty_text = "—"

[[tables.einheiten.table.columns]]
field = "status"
label = "einheit.status"
sortable = true
width = "width.w180"
display = "badge"
badge_colors = { vermietet = "green", leer = "red", eigennutzung = "blue", renovierung = "yellow" }

[tables.einheit.table.actions]
label = "einheit.aktionen"
width = "width.actions"

[tables.einheiten.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/einheit.form" }
vertrag = { icon = "FileSignature", dialog = "forms/vertrag.form", visible_if = { field = "status", equals = "leer" }, label = "actions.vertrag_anlegen" }

[tables.kautionen.table]
entity = "kaution"

[[tables.kautionen.table.columns]]
field = "vertrag.mieter.computed.display_name"
label = "kaution.mieter"
sortable = true
width = "width.w300"

[[tables.kautionen.table.columns]]
field = "vertrag.einheit.bezeichnung"
label = "kaution.einheit"
sortable = true
width = "width.w260"

[[tables.kautionen.table.columns]]
field = "betrag"
label = "kaution.betrag"
sortable = true
width = "width.w180"
format = "currency"

[[tables.kautionen.table.columns]]
field = "eingangsdatum"
label = "kaution.eingangsdatum"
sortable = true
width = "width.w180"
format = "date"

[[tables.kautionen.table.columns]]
field = "status"
label = "kaution.status"
width = "width.w180"
display = "badge"

[[tables.kautionen.table.columns]]
field = "rueckzahlungsdatum"
label = "kaution.rueckzahlungsdatum"
width = "width.w120"
format = "date"

[tables.kautionen.table.actions]
label = "kautionen.aktionen"
width = "width.actions"

[tables.kautionen.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/kaution.form" }
delete = { icon = "Trash2", confirm = true }

[tables.mieter.table]
entity = "mieter"
row_click = "navigate"
row_click_route = "/mieter/:id"

[[tables.mieter.table.columns]]
field = "computed.display_name"
label = "mieter.name"
sortable = true
sort_field = "nachname"
width = "width.w260"
template = "{vorname} {nachname}"

[[tables.mieter.table.columns]]
field = "mobil"
fallback_fields = ["telefon"]
label = "mieter.telefon"
width = "width.w160"

[[tables.mieter.table.columns]]
field = "email"
label = "mieter.email"
width = "width.w200"

[[tables.mieter.table.columns]]
field = "computed.aktuelle_einheit.bezeichnung"
label = "mieter.einheit"
width = "width.w200"
empty_text = "—"

[[tables.mieter.table.columns]]
field = "status"
label = "mieter.status"
sortable = true
width = "width.w100"
display = "badge"
badge_colors = { aktiv = "green", gekuendigt = "yellow", ehemalig = "gray" }

[tables.mieter.table.actions]
label = "mieter.aktionen"
width = "width.actions"

[tables.mieter.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/mieter.form", label = "" }
vertrag = { icon = "FileSignature", label = "", handler = "navigate_vertrag" }
einheit = { icon = "Home", label = "", handler = "navigate_einheit" }

[tables.objekte.table]
entity = "objekt"
row_click = "navigate"
row_click_route = "/objekte/:id"

[[tables.objekte.table.columns]]
field = "bezeichnung"
label = "objekt.bezeichnung"
sortable = true
width = "width.w300"

[[tables.objekte.table.columns]]
field = "adresse"
label = "objekt.adresse"
sortable = true
width = "width.w300"
template = "{adresse}, {plz} {ort}"

[[tables.objekte.table.columns]]
field = "typ"
label = "objekt.typ"
sortable = true
width = "width.w120"
display = "badge"
badge_colors = { wohnraum = "blue", gewerbe = "orange", gemischt = "purple" }

[[tables.objekte.table.columns]]
field = "computed.anzahl_einheiten"
label = "objekt.einheiten"
sortable = true
width = "width.w120"
align = "center"

[[tables.objekte.table.columns]]
field = "computed.leerstand"
label = "objekt.leerstand"
sortable = true
width = "width.w120"
align = "center"
highlight_if = { condition = "> 0", color = "yellow" }

[[tables.objekte.table.columns]]
field = "computed.gesamt_flaeche"
label = "objekt.flaeche"
sortable = true
width = "width.w180"
format = "number"
suffix = " m²"

[tables.objekte.table.actions]
label = "objekte.aktionen"
width = "width.actions"

[tables.objekte.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/objekt.form" }
delete = { icon = "Trash2", confirm = true, confirm_message = "labels.confirm.objekt_loeschen" }

[tables.rechnungen.table]
entity = "rechnung"

[[tables.rechnungen.table.columns]]
field = "rechnungsdatum"
label = "rechnung.datum"
sortable = true
width = "width.w120"
format = "date"

[[tables.rechnungen.table.columns]]
field = "objekt.bezeichnung"
label = "rechnung.objekt"
sortable = true
width = "width.w200"

[[tables.rechnungen.table.columns]]
field = "kostenart.bezeichnung"
label = "rechnung.kostenart"
sortable = true
width = "width.w180"

[[tables.rechnungen.table.columns]]
field = "rechnungsnummer"
label = "rechnung.nummer"
width = "width.w160"

[[tables.rechnungen.table.columns]]
field = "betrag"
label = "rechnung.betrag"
sortable = true
width = "width.w160"
format = "currency"

[[tables.rechnungen.table.columns]]
field = "zeitraum_von"
label = "rechnung.zeitraum"
width = "width.w180"
template = "{zeitraum_von|date} - {zeitraum_bis|date}"

[[tables.rechnungen.table.columns]]
field = "computed.ist_bezahlt"
label = "rechnung.bezahlt"
sortable = true
width = "width.w100"
display = "boolean_icon"
icons = { true = "Check", false = "X" }

[[tables.rechnungen.table.columns]]
field = "dokument_id"
label = ""
width = "width.w60"
display = "icon_link"
icon = "FileText"
visible_if = { field = "dokument_id", is_set = true }
click = "preview_document"

[tables.rechnungen.table.actions]
label = "rechnungen.aktionen"
width = "width.actions"

[tables.rechnungen.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/rechnung.form" }
bezahlen = { icon = "CheckCircle", handler = "rechnung.markAsPaid", visible_if = { field = "computed.ist_bezahlt", equals = false } }
dokument = { icon = "Upload", dialog = "forms/dokument.form", defaults = { objekt_id = ":objekt_id" } }

[tables.sollstellungen.table]
entity = "sollstellung"

[[tables.sollstellungen.table.columns]]
field = "monat"
label = "sollstellung.monat"
sortable = true
width = "width.w160"
format = "month"

[[tables.sollstellungen.table.columns]]
field = "vertrag.mieter.computed.display_name"
label = "sollstellung.mieter"
sortable = true
width = "22%"

[[tables.sollstellungen.table.columns]]
field = "vertrag.einheit.bezeichnung"
label = "sollstellung.einheit"
width = "width.w200"

[[tables.sollstellungen.table.columns]]
field = "sollbetrag"
label = "sollstellung.soll"
sortable = true
width = "width.w160"
format = "currency"

[[tables.sollstellungen.table.columns]]
field = "istbetrag"
label = "sollstellung.ist"
sortable = true
width = "width.w160"
format = "currency"

[[tables.sollstellungen.table.columns]]
field = "computed.differenz"
label = "sollstellung.differenz"
sortable = true
width = "width.w160"
format = "currency"
color_rule = { negative = "red", positive = "green", zero = "inherit" }

[[tables.sollstellungen.table.columns]]
field = "status"
label = "sollstellung.status"
sortable = true
width = "width.w160"
display = "badge"
badge_colors = { offen = "red", teilweise = "yellow", bezahlt = "green", ueberzahlt = "blue" }

[tables.sollstellungen.table.actions]
label = "sollstellungen.aktionen"
width = "width.actions"

[tables.sollstellungen.table.row_actions]
zahlung = { icon = "Plus", dialog = "forms/zahlung.form", defaults = { vertrag_id = ":vertrag_id", monat_fuer = ":monat" } }

[tables.vertraege.table]
entity = "vertrag"
row_click = "navigate"
row_click_route = "/vertraege/:id"

[[tables.vertraege.table.columns]]
field = "vertragsnummer"
label = "vertrag.vertragsnummer"
sortable = true
width = "width.w120"

[[tables.vertraege.table.columns]]
field = "mieter.computed.display_name"
label = "vertrag.mieter"
sortable = true
width = "width.w260"

[[tables.vertraege.table.columns]]
field = "einheit.bezeichnung"
label = "vertrag.einheit"
sortable = true
width = "width.w180"

[[tables.vertraege.table.columns]]
field = "beginn"
label = "vertrag.beginn"
sortable = true
width = "width.w120"
format = "date"

[[tables.vertraege.table.columns]]
field = "ende"
label = "vertrag.ende"
sortable = true
width = "width.w120"
format = "date"
empty_text = "unbefristet"

[[tables.vertraege.table.columns]]
field = "computed.gesamtmiete"
label = "vertrag.gesamtmiete"
sortable = true
width = "width.w160"
format = "currency"

[[tables.vertraege.table.columns]]
field = "computed.ist_aktiv"
label = "vertrag.status"
width = "width.w120"
display = "status_indicator"
status_map = { true = { label = "aktiv", color = "green" }, false = { label = "beendet", color = "gray" } }

[tables.vertraege.table.actions]
label = "vertraege.aktionen"
width = "width.actions"

[tables.vertraege.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/vertrag.form" }
kuendigen = { icon = "XCircle", dialog = "dialogs/kuendigung", visible_if = { field = "computed.ist_aktiv", equals = true } }

[tables.zaehler.table]
entity = "zaehler"

[[tables.zaehler.table.columns]]
field = "objekt.bezeichnung"
label = "zaehler.objekt"
sortable = true
width = "width.w260"

[[tables.zaehler.table.columns]]
field = "einheit.bezeichnung"
label = "zaehler.einheit"
width = "width.w180"
empty_text = "Hauptzähler"

[[tables.zaehler.table.columns]]
field = "typ"
label = "zaehler.typ"
sortable = true
width = "width.w160"
display = "badge"

[[tables.zaehler.table.columns]]
field = "zaehlernummer"
label = "zaehler.nummer"
width = "width.w180"

[[tables.zaehler.table.columns]]
field = "ist_hauptzaehler"
label = "zaehler.haupt"
width = "width.w100"
display = "boolean_icon"

[[tables.zaehler.table.columns]]
field = "computed.letzter_stand.stand"
label = "zaehler.letzter_stand"
width = "width.w180"
template = "{value} {messeinheit}"

[[tables.zaehler.table.columns]]
field = "computed.letzter_stand.datum"
label = "zaehler.abgelesen_am"
sortable = true
width = "width.w180"
format = "date"

[tables.zaehler.table.actions]
label = "zaehler.aktionen"
width = "width.actions"

[tables.zaehler.table.row_actions]
ablesung = { icon = "Plus", dialog = "forms/zaehlerstand.form", defaults = { zaehler_id = ":id" } }
edit = { icon = "Pencil", dialog = "forms/zaehler.form" }
historie = { icon = "History", dialog = "dialogs/zaehler_historie" }

[tables.zahlungen.table]
entity = "zahlung"

[[tables.zahlungen.table.columns]]
field = "datum"
label = "zahlung.datum"
sortable = true
width = "width.w160"
format = "date"

[[tables.zahlungen.table.columns]]
field = "vertrag.mieter.computed.display_name"
label = "zahlung.mieter"
sortable = true
width = "width.w260"

[[tables.zahlungen.table.columns]]
field = "vertrag.einheit.bezeichnung"
label = "zahlung.einheit"
width = "width.w180"

[[tables.zahlungen.table.columns]]
field = "betrag"
label = "zahlung.betrag"
sortable = true
width = "width.w160"
format = "currency"

[[tables.zahlungen.table.columns]]
field = "typ"
label = "zahlung.typ"
sortable = true
width = "width.w160"
display = "badge"

[[tables.zahlungen.table.columns]]
field = "monat_fuer"
label = "zahlung.monat_fuer"
sortable = true
width = "width.w120"
format = "month"

[[tables.zahlungen.table.columns]]
field = "verwendungszweck"
label = "zahlung.verwendungszweck"
width = "19%"
truncate = 30

[tables.zahlungen.table.actions]
label = "zahlungen.aktionen"
width = "width.actions"

[tables.zahlungen.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/zahlung.form" }
delete = { icon = "Trash2", confirm = true }

# =============================================================================
# VIEWS - View-Definitionen
# =============================================================================

# =============================================================================
# VIEWS - Seiten-Definitionen (100% Config-Driven)
# =============================================================================

[views.dashboard]
id = "dashboard"
title = "labels.views.dashboard"
route = "/dashboard"
layout = "grid"
grid_cols = { sm = 1, md = 2, lg = 3 }
gap = "gap-6"
padding = "p-6"
background = "bg-transparent"

# ============ STATS CARDS (Übersichtskarten) ============

[[views.dashboard.stats_cards]]
id = "objekte"
title = "dashboard.objekte"
field = "objekte"
icon = "Building2"
color = "blue"
sortable = true
order = 10

[[views.dashboard.stats_cards]]
id = "mieter"
title = "dashboard.mieter"
field = "mieter"
icon = "Users"
color = "green"
sortable = true
order = 20

[[views.dashboard.stats_cards]]
id = "vertraege"
title = "dashboard.vertraege"
field = "vertraege"
icon = "FileText"
color = "purple"
sortable = true
order = 30

[[views.dashboard.stats_cards]]
id = "offene_rechnungen"
title = "dashboard.offene_rechnungen"
field = "offeneRechnungen"
icon = "Wallet"
color = "orange"
sortable = true
order = 40

[[views.dashboard.stats_cards]]
id = "dokumente"
title = "dashboard.dokumente"
field = "dokumente"
icon = "FileArchive"
color = "blue"
sortable = true
order = 50

[[views.dashboard.stats_cards]]
id = "erinnerungen"
title = "dashboard.erinnerungen"
field = "offeneErinnerungen"
icon = "FileCheck"
color = "green"
sortable = true
order = 60

# ============ CARDS (Textblöcke) ============

[[views.dashboard.cards]]
id = "schnellzugriff"
title = "dashboard.schnellzugriff"
subtitle = "dashboard.schnellzugriff_desc"
type = "action_buttons"
grid_span = { col = 2, row = 1 }
layout = "flex"
flex_wrap = true
gap = "gap-2"
padding = "p-6"
background = "bg-slate-900"
border = "border border-slate-800"
rounded = "rounded-lg"
shadow = "shadow-lg"

  [[views.dashboard.cards.actions]]
  label = "dashboard.btn_dokumente"
  route = "/dokumente"
  icon = "FileText"
  style = "secondary"
  order = 10

  [[views.dashboard.cards.actions]]
  label = "dashboard.btn_rechnungen"
  route = "/nebenkosten"
  icon = "Receipt"
  style = "secondary"
  order = 20

  [[views.dashboard.cards.actions]]
  label = "dashboard.btn_abrechnungen"
  route = "/nebenkosten"
  icon = "BarChart3"
  style = "secondary"
  order = 30

  [[views.dashboard.cards.actions]]
  label = "dashboard.btn_steuerberater_export"
  api_endpoint = "/api/export/steuerberater"
  icon = "Download"
  style = "success"
  download = true
  order = 40

[[views.dashboard.cards]]
id = "status"
title = "dashboard.status"
type = "status_summary"
grid_span = { col = 1, row = 1 }
padding = "p-6"
background = "bg-slate-900"
border = "border border-slate-800"
rounded = "rounded-lg"
shadow = "shadow-lg"

# ============ STYLING ============

[views.dashboard.styling]
card_bg = "bg-slate-900"
card_border = "border border-slate-800"
card_rounded = "rounded-lg"
card_shadow = "shadow-lg shadow-black/30"
card_padding = "p-6"

stats_card_border = "border border-slate-800"
stats_card_rounded = "rounded-lg"
stats_card_padding = "p-6"
stats_card_shadow = "shadow-lg shadow-black/30"

color_schemes = { blue = "bg-blue-900/40 text-blue-100 border-blue-800", green = "bg-emerald-900/40 text-emerald-100 border-emerald-800", purple = "bg-purple-900/40 text-purple-100 border-purple-800", orange = "bg-amber-900/40 text-amber-100 border-amber-800" }

[views.dokumente]
id = "dokumente"
title = "labels.views.dokumente"
route = "/dokumente"
layout = "single"

[views.dokumente.content]
table = "tables/dokumente.table"
default_sort = { field = "hochgeladen_am", direction = "desc" }

  [[view.content.filters]]
  field = "objekt_id"
  type = "select"
  label = "filter.objekt"
  options_from = "objekt"

  [[view.content.filters]]
  field = "typ"
  type = "select"
  label = "filter.typ"

  [[view.content.filters]]
  field = "jahr"
  type = "year_picker"
  label = "filter.jahr"

[views.dokumente.content.actions]
upload = { label = "actions.dokument_hochladen", dialog = "forms/dokument.form" }

[views.dokumente.content.bulk_actions]
export = { label = "actions.steuerberater_export", dialog = "dialogs/steuerberater_export" }
delete = { label = "actions.loeschen", confirm = true }

[views.einstellungen]
id = "einstellungen"
title = "labels.views.einstellungen"
route = "/einstellungen"
layout = "settings"

  [[view.sections]]
  id = "eigentuemer"
  label = "settings.eigentuemer"
  icon = "User"
  form = "forms/eigentuemer.form"
  description = "labels.settings.eigentuemer_desc"

  [[view.sections]]
  id = "kostenarten"
  label = "settings.kostenarten"
  icon = "Tag"
  type = "table_editable"
  table = "tables/kostenarten.table"
  form = "forms/kostenart.form"
  description = "labels.settings.kostenarten_desc"

  [[view.sections]]
  id = "umlageschluessel"
  label = "settings.umlageschluessel"
  icon = "Percent"
  type = "info"
  content = "catalogs/umlageschluessel.catalog"
  description = "labels.settings.umlageschluessel_desc"

  [[view.sections]]
  id = "backup"
  label = "settings.backup"
  icon = "Database"
  type = "actions"
  description = "labels.settings.backup_desc"

    [[view.sections.actions]]
    id = "backup_create"
    label = "actions.backup_erstellen"
    handler = "system.createBackup"

    [[view.sections.actions]]
    id = "backup_restore"
    label = "actions.backup_wiederherstellen"
    handler = "system.restoreBackup"
    confirm = true

[views.finanzen]
id = "finanzen"
title = "labels.views.finanzen"
route = "/finanzen"
layout = "tabbed"

  [[view.tabs]]
  id = "zahlungen"
  label = "tabs.zahlungen"
  route = "/finanzen/zahlungen"
  table = "tables/zahlungen.table"
  default_sort = { field = "datum", direction = "desc" }

    [[view.tabs.filters]]
    field = "datum"
    type = "date_range"
    label = "filter.zeitraum"

    [[view.tabs.filters]]
    field = "typ"
    type = "select"

  [view.tabs.actions]
  create = { label = "actions.zahlung_erfassen", dialog = "forms/zahlung.form" }

  [[view.tabs]]
  id = "sollstellung"
  label = "tabs.sollstellung"
  route = "/finanzen/sollstellung"
  table = "tables/sollstellungen.table"

    [[view.tabs.filters]]
    field = "monat"
    type = "month_picker"
    default = "current"

    [[view.tabs.filters]]
    field = "status"
    type = "select"

  [view.tabs.summary]
  show = true
  fields = ["sollbetrag", "istbetrag", "differenz"]
  aggregate = "sum"

  [[view.tabs]]
  id = "kautionen"
  label = "tabs.kautionen"
  route = "/finanzen/kautionen"
  table = "tables/kautionen.table"

    [[view.tabs.filters]]
    field = "status"
    type = "select"

  [view.tabs.summary]
  show = true
  fields = ["betrag"]
  aggregate = "sum"
  group_by = "status"

[views.mieter]
id = "mieter"
title = "labels.views.mieter"
route = "/mieter"
layout = "list_detail"

[views.mieter.list]
table = "tables/mieter.table"
search_fields = ["vorname", "nachname", "email"]
default_sort = { field = "nachname", direction = "asc" }

  [[view.list.filters]]
  field = "status"
  type = "select"
  label = "filter.status"
  default = "aktiv"

[views.mieter.list.actions]
create = { label = "actions.mieter_anlegen", dialog = "forms/mieter.form" }

[views.mieter.detail]
route = "/mieter/:id"
title_field = "computed.display_name"

  [[view.detail.tabs]]
  id = "stammdaten"
  label = "tabs.stammdaten"
  type = "form_readonly"
  form = "forms/mieter.form"
  edit_action = { dialog = "forms/mieter.form" }

  [[view.detail.tabs]]
  id = "vertrag"
  label = "tabs.vertrag"
  type = "table"
  table = "tables/vertraege.table"
  filter = { mieter_id = ":id" }

  [[view.detail.tabs]]
  id = "zahlungen"
  label = "tabs.zahlungen"
  type = "table"
  table = "tables/zahlungen.table"
  filter = { "vertrag.mieter_id" = ":id" }
  actions = { create = { label = "actions.zahlung_erfassen", dialog = "forms/zahlung.form" } }

  [[view.detail.tabs]]
  id = "dokumente"
  label = "tabs.dokumente"
  type = "table"
  table = "tables/dokumente.table"
  filter = { mieter_id = ":id" }
  actions = { upload = { label = "actions.dokument_hochladen", dialog = "forms/dokument.form", defaults = { mieter_id = ":id" } } }

  [[view.detail.tabs]]
  id = "kaution"
  label = "tabs.kaution"
  type = "form_readonly"
  form = "forms/kaution.form"
  data_path = "aktiver_vertrag.kaution"
  empty_message = "labels.kaution.keine_kaution"

[views.nebenkosten]
id = "nebenkosten"
title = "labels.views.nebenkosten"
route = "/nebenkosten"
layout = "tabbed"

  [[view.tabs]]
  id = "rechnungen"
  label = "tabs.rechnungen"
  route = "/nebenkosten/rechnungen"
  table = "tables/rechnungen.table"
  default_sort = { field = "rechnungsdatum", direction = "desc" }

    [[view.tabs.filters]]
    field = "objekt_id"
    type = "select"
    label = "filter.objekt"
    options_from = "objekt"

    [[view.tabs.filters]]
    field = "kostenart_id"
    type = "select"
    label = "filter.kostenart"
    options_from = "kostenart"

    [[view.tabs.filters]]
    field = "computed.jahr"
    type = "year_picker"
    label = "filter.jahr"

    [[view.tabs.filters]]
    field = "computed.ist_bezahlt"
    type = "boolean_toggle"
    label = "filter.bezahlt"

  [view.tabs.actions]
  create = { label = "actions.rechnung_erfassen", dialog = "forms/rechnung.form" }

  [view.tabs.summary]
  show = true
  fields = ["betrag"]
  aggregate = "sum"
  group_by = "kostenart.bezeichnung"

  [[view.tabs]]
  id = "abrechnungen"
  label = "tabs.abrechnungen"
  route = "/nebenkosten/abrechnungen"
  table = "tables/abrechnungen.table"

    [[view.tabs.filters]]
    field = "objekt_id"
    type = "select"
    options_from = "objekt"

    [[view.tabs.filters]]
    field = "jahr"
    type = "year_picker"

    [[view.tabs.filters]]
    field = "status"
    type = "select"

  [view.tabs.actions]
  create = { label = "actions.abrechnung_erstellen", dialog = "dialogs/nk_abrechnung_wizard" }

  [[view.tabs]]
  id = "zaehler"
  label = "tabs.zaehler"
  route = "/nebenkosten/zaehler"
  table = "tables/zaehler.table"

    [[view.tabs.filters]]
    field = "objekt_id"
    type = "select"
    options_from = "objekt"

    [[view.tabs.filters]]
    field = "typ"
    type = "select"

  [view.tabs.actions]
  create = { label = "actions.zaehler_anlegen", dialog = "forms/zaehler.form" }
  ablesung = { label = "actions.ablesung_erfassen", dialog = "forms/zaehlerstand.form" }

[views.objekte]
id = "objekte"
title = "labels.views.objekte"
route = "/objekte"
layout = "list_detail"

[views.objekte.list]
table = "tables/objekte.table"
search_fields = ["bezeichnung", "adresse", "ort"]
default_sort = { field = "bezeichnung", direction = "asc" }

  [[view.list.filters]]
  field = "typ"
  type = "select"
  label = "filter.typ"

  [[view.list.filters]]
  field = "computed.leerstand"
  type = "boolean"
  label = "filter.mit_leerstand"
  condition = "> 0"

[views.objekte.list.actions]
create = { label = "actions.objekt_anlegen", dialog = "forms/objekt.form" }

[views.objekte.detail]
route = "/objekte/:id"
title_field = "bezeichnung"

  [[view.detail.tabs]]
  id = "stammdaten"
  label = "tabs.stammdaten"
  type = "form_readonly"
  form = "forms/objekt.form"
  edit_action = { dialog = "forms/objekt.form" }

  [[view.detail.tabs]]
  id = "einheiten"
  label = "tabs.einheiten"
  type = "table"
  table = "tables/einheiten.table"
  filter = { objekt_id = ":id" }
  actions = { create = { label = "actions.einheit_anlegen", dialog = "forms/einheit.form", defaults = { objekt_id = ":id" } } }

  [[view.detail.tabs]]
  id = "zaehler"
  label = "tabs.zaehler"
  type = "table"
  table = "tables/zaehler.table"
  filter = { objekt_id = ":id" }
  visible_if = { field = "ist_multi_einheit", equals = true }
  actions = { create = { label = "actions.zaehler_anlegen", dialog = "forms/zaehler.form", defaults = { objekt_id = ":id" } } }

  [[view.detail.tabs]]
  id = "rechnungen"
  label = "tabs.rechnungen"
  type = "table"
  table = "tables/rechnungen.table"
  filter = { objekt_id = ":id" }
  actions = { create = { label = "actions.rechnung_erfassen", dialog = "forms/rechnung.form", defaults = { objekt_id = ":id" } } }

  [[view.detail.tabs]]
  id = "dokumente"
  label = "tabs.dokumente"
  type = "table"
  table = "tables/dokumente.table"
  filter = { objekt_id = ":id" }
  actions = { upload = { label = "actions.dokument_hochladen", dialog = "forms/dokument.form", defaults = { objekt_id = ":id" } } }

[views.vertraege]
id = "vertraege"
title = "labels.views.vertraege"
route = "/vertraege"
layout = "list_detail"

[views.vertraege.list]
table = "tables/vertraege.table"
search_fields = ["mieter.nachname", "einheit.bezeichnung", "vertragsnummer"]
default_sort = { field = "beginn", direction = "desc" }

  [[view.list.filters]]
  field = "computed.ist_aktiv"
  type = "boolean_toggle"
  label = "filter.nur_aktive"
  default = true

  [[view.list.filters]]
  field = "typ"
  type = "select"
  label = "filter.typ"

[views.vertraege.list.actions]
create = { label = "actions.vertrag_anlegen", dialog = "forms/vertrag.form" }

[views.vertraege.detail]
route = "/vertraege/:id"
title_field = "vertragsnummer"

  [[view.detail.header_info]]
  fields = ["mieter.computed.display_name", "einheit.bezeichnung", "computed.gesamtmiete"]

  [[view.detail.tabs]]
  id = "konditionen"
  label = "tabs.konditionen"
  type = "form_readonly"
  form = "forms/vertrag.form"
  edit_action = { dialog = "forms/vertrag.form" }

  [[view.detail.tabs]]
  id = "kaution"
  label = "tabs.kaution"
  type = "form_editable"
  form = "forms/kaution.form"
  data_path = "kaution"

  [[view.detail.tabs]]
  id = "zahlungen"
  label = "tabs.zahlungen"
  type = "table"
  table = "tables/zahlungen.table"
  filter = { vertrag_id = ":id" }

  [[view.detail.tabs]]
  id = "sollstellung"
  label = "tabs.sollstellung"
  type = "table"
  table = "tables/sollstellungen.table"
  filter = { vertrag_id = ":id" }

  [[view.detail.tabs]]
  id = "dokumente"
  label = "tabs.dokumente"
  type = "table"
  table = "tables/dokumente.table"
  filter = { vertrag_id = ":id" }

# =============================================================================
# IMPORTS - Externe Konfigurationsdateien (Kataloge, Labels, Validierung, Design)
# =============================================================================
# [imports] SECTION REMOVED - All configurations are now consolidated in this file
# Only catalogs remain as separate files in config/catalogs/
# =============================================================================
