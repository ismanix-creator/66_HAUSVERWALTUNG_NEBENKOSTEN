# =============================================================================
# MIETVERWALTUNG - MASTER CONFIGURATION (Konsolidiert)
# 100% Config-Driven Property Management System
# =============================================================================
# @version: 1.0.0
# @lastModified: 2025-12-18
# @structure: Basis-Config + konsolidierte Entities/Forms/Tables/Views
# @note: Kataloge bleiben in config/catalogs/
#        Labels, Validation, Design bleiben als Imports
# =============================================================================

# =============================================================================
# META - Konfigurationsmetadaten
# =============================================================================
[meta]
version = "1.0.0"
schema_version = "2"
last_modified = "2025-12-18"
environment = "development"
config_format = "toml"

# =============================================================================
# APP - Anwendungseinstellungen
# =============================================================================
[app]
name = "Mietverwaltung"
version = "1.0.0"
description = "Private Mietobjekt-Verwaltung"
locale = "de-DE"
currency = "EUR"
timezone = "Europe/Berlin"
date_format = "DD.MM.YYYY"
time_format = "HH:mm"
datetime_format = "DD.MM.YYYY HH:mm"

[app.owner]
name = "Akki Scholze"
address = ""
tax_number = ""
email = ""
phone = ""
iban = ""
bic = ""

[app.defaults]
kuendigungsfrist_monate = 3
kaution_monate = 3
nk_abrechnungsfrist_monate = 12
mieterhoehung_sperrfrist_monate = 15
mahnfrist_tage = 14
zahlungsziel_tage = 14

[app.storage]
dokumente_pfad = "./data/dokumente"
backup_pfad = "./data/backups"
temp_pfad = "./data/temp"
max_upload_size_mb = 25
allowed_file_types = ["pdf", "jpg", "jpeg", "png", "doc", "docx", "xls", "xlsx"]

# =============================================================================
# SERVER - Server-Konfiguration
# =============================================================================
[server]
host = "127.0.0.1"
port = 3002
cors_origin = "http://localhost:5174"
request_timeout_ms = 30000
max_request_size = "50mb"

[server.api]
base_path = "/api"
enable_swagger = false
enable_graphql = false

[server.static]
directory = "./public"
cache_control = "public, max-age=3600"
enable_compression = true

# =============================================================================
# DATABASE - Datenbank-Einstellungen
# =============================================================================
[database]
type = "sqlite"
path = "./data/database.sqlite"
wal_mode = true
foreign_keys = true
auto_vacuum = "incremental"
busy_timeout_ms = 5000

[database.migrations]
auto_run = true
directory = "./scripts/migrations"

[database.backup]
enabled = true
schedule = "0 3 * * *"
retention_days = 30
directory = "./data/backups"

# =============================================================================
# NAVIGATION - Navigationsstruktur
# =============================================================================
[navigation]
mode = "sidebar"
position = "left"
collapsible = true
default_collapsed = false

[[navigation.items]]
id = "dashboard"
label = "labels.nav.dashboard"
route = "/dashboard"
icon = "LayoutDashboard"
order = 10

[[navigation.items]]
id = "objekte"
label = "Objekte/Einheiten"
route = "/objekte"
icon = "Building2"
order = 20

[[navigation.items]]
id = "mieter"
label = "labels.nav.mieter"
route = "/mieter"
icon = "Users"
order = 30

[[navigation.items]]
id = "vertraege"
label = "labels.nav.vertraege"
route = "/vertraege"
icon = "FileText"
order = 40

[[navigation.items]]
id = "finanzen"
label = "labels.nav.finanzen"
route = "/finanzen"
icon = "BarChart3"
order = 50

[[navigation.items]]
id = "nebenkosten"
label = "labels.nav.nebenkosten"
route = "/nebenkosten"
icon = "Receipt"
order = 60

# =============================================================================
# ROUTES - API-Routing
# =============================================================================
[routes]
base = "/api"
version = "v1"
mobile_readonly = true

# =============================================================================
# PAGINATION - Seitennummerierung
# =============================================================================
[pagination]
default_limit = 100
max_limit = 1000
offset_default = 0

# =============================================================================
# SEARCH - Sucheinstellungen
# =============================================================================
[search]
enabled = true
debounce_ms = 300
min_chars = 2
max_results = 50

# =============================================================================
# EXPORT - Export-Einstellungen
# =============================================================================
[export]
formats = ["pdf", "csv", "xlsx"]
max_records = 10000

# =============================================================================
# NOTIFICATIONS - Benachrichtigungen
# =============================================================================
[notifications]
enabled = true
toast_duration_ms = 3000
sound_enabled = false

# =============================================================================
# AUTOSAVE - Automatisches Speichern
# =============================================================================
[autosave]
enabled = true
interval_ms = 30000
debounce_ms = 500

# =============================================================================
# SHORTCUTS - Tastaturkürzel
# =============================================================================
[shortcuts]
enabled = true
overlay_key = "Shift+?"

# =============================================================================
# LOGGING - Logging-Einstellungen
# =============================================================================
[logging]
level = "info"
format = "json"
output = "console"
max_size_mb = 100
retention_days = 7

# =============================================================================
# SECURITY - Sicherheitseinstellungen
# =============================================================================
[security]
rate_limit_enabled = false
rate_limit_window_ms = 60000
rate_limit_max_requests = 100
csrf_protection = false
sql_injection_prevention = true

# =============================================================================
# PERFORMANCE - Performance-Einstellungen
# =============================================================================
[performance]
cache_enabled = true
cache_ttl_seconds = 3600
compression_enabled = true
query_optimization = true

# =============================================================================
# DEBUG - Debug-Einstellungen
# =============================================================================
[debug]
enabled = false
show_query_time = false
show_render_count = false
log_api_calls = false
mock_delay_ms = 0

[entities.dokument]
name = "dokument"
table_name = "dokumente"
label = "labels.entity.dokument"
label_plural = "labels.entity.dokumente"
icon = "File"
primary_key = "id"

[entities.dokument.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.dokument.fields.objekt_id]
type = "uuid"
reference = "objekt"
label = "labels.dokument.objekt"

[entities.dokument.fields.einheit_id]
type = "uuid"
reference = "einheit"
label = "labels.dokument.einheit"

[entities.dokument.fields.mieter_id]
type = "uuid"
reference = "mieter"
label = "labels.dokument.mieter"

[entities.dokument.fields.vertrag_id]
type = "uuid"
reference = "vertrag"
label = "labels.dokument.vertrag"

[entities.dokument.fields.typ]
type = "enum"
required = true
options = ["rechnung", "vertrag", "ausweis", "korrespondenz", "foto", "sonstig"]
default = "sonstig"
label = "labels.dokument.typ"

[entities.dokument.fields.bezeichnung]
type = "string"
required = true
max_length = 200
label = "labels.dokument.bezeichnung"

[entities.dokument.fields.dateiname]
type = "string"
required = true
max_length = 255
label = "labels.dokument.dateiname"

[entities.dokument.fields.dateipfad]
type = "string"
required = true
label = "labels.dokument.dateipfad"

[entities.dokument.fields.dateigroesse]
type = "integer"
label = "labels.dokument.dateigroesse"

[entities.dokument.fields.mime_type]
type = "string"
max_length = 100
label = "labels.dokument.mime_type"

[entities.dokument.fields.datum]
type = "date"
label = "labels.dokument.datum"
description = "Dokumentdatum (z.B. Rechnungsdatum)"

[entities.dokument.fields.jahr]
type = "integer"
label = "labels.dokument.jahr"
description = "Für Steuerberater-Sortierung"

[entities.dokument.fields.hochgeladen_am]
type = "datetime"
auto_generate = true
label = "labels.dokument.hochgeladen_am"

[entities.dokument.relations]
objekt = { type = "many_to_one", target = "objekt", foreign_key = "objekt_id" }
einheit = { type = "many_to_one", target = "einheit", foreign_key = "einheit_id" }
mieter = { type = "many_to_one", target = "mieter", foreign_key = "mieter_id" }
vertrag = { type = "many_to_one", target = "vertrag", foreign_key = "vertrag_id" }

[entities.dokument.validation]
mindestens_eine_zuordnung = { rule = "objekt_id is not null or mieter_id is not null or vertrag_id is not null", message = "labels.validation.dokument_zuordnung" }

[entities.einheit]
name = "einheit"
table_name = "einheiten"
label = "labels.entity.einheit"
label_plural = "labels.entity.einheiten"
icon = "DoorOpen"
primary_key = "id"

[entities.einheit.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.einheit.fields.objekt_id]
type = "uuid"
required = true
reference = "objekt"
label = "labels.einheit.objekt"
placeholder = "Objekt wählen"

[entities.einheit.fields.bezeichnung]
type = "string"
required = true
max_length = 50
label = "labels.einheit.bezeichnung"
placeholder = "z.B. EG links, Halle A"

[entities.einheit.fields.typ]
type = "enum"
required = true
options = ["wohnung", "gewerbe", "stellplatz", "keller", "sonstig"]
default = "wohnung"
label = "labels.einheit.typ"
placeholder = "wohnung"

[entities.einheit.fields.flaeche]
type = "decimal"
required = true
min = 1
precision = 2
suffix = "m²"
label = "labels.einheit.flaeche"
placeholder = "75.0"

[entities.einheit.fields.anzahl_raeume]
type = "decimal"
min = 1
precision = 1
label = "labels.einheit.anzahl_raeume"
visible_if = { field = "typ", in = ["wohnung"] }
placeholder = "3.5"

[entities.einheit.fields.etage]
type = "string"
max_length = 20
label = "labels.einheit.etage"
placeholder = "z.B. EG, 1. OG, DG"

[entities.einheit.fields.ausstattung]
type = "multiselect"
options = ["balkon", "terrasse", "keller", "stellplatz", "einbaukueche", "aufzug", "gaeste_wc"]
label = "labels.einheit.ausstattung"
placeholder = "balkon, keller"

[entities.einheit.fields.status]
type = "enum"
required = true
options = ["vermietet", "leer", "eigennutzung", "renovierung"]
default = "leer"
label = "labels.einheit.status"
placeholder = "leer"

[entities.einheit.fields.notiz]
type = "text"
label = "labels.common.notiz"
placeholder = "Besondere Merkmale, Schlüsselübergabe"

[entities.einheit.relations]
objekt = { type = "many_to_one", target = "objekt", foreign_key = "objekt_id" }
vertraege = { type = "one_to_many", target = "vertrag", foreign_key = "einheit_id" }
zaehler = { type = "one_to_many", target = "zaehler", foreign_key = "einheit_id" }

[entities.einheit.computed]
aktueller_vertrag = { formula = "first(vertraege where ende is null or ende > now())" }
aktueller_mieter = { formula = "aktueller_vertrag.mieter" }

[entities.erinnerung]
name = "erinnerung"
table_name = "erinnerungen"
label = "labels.entity.erinnerung"
label_plural = "labels.entity.erinnerungen"
icon = "Bell"
primary_key = "id"

[entities.erinnerung.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.erinnerung.fields.typ]
type = "enum"
required = true
options = ["mieterhoehung", "vertragsende", "zaehlerablesung", "rueckstand", "nk_abrechnung", "kaution_rueckzahlung", "sonstig"]
label = "labels.erinnerung.typ"

[entities.erinnerung.fields.bezug_typ]
type = "enum"
options = ["vertrag", "objekt", "mieter", "einheit"]
label = "labels.erinnerung.bezug_typ"

[entities.erinnerung.fields.bezug_id]
type = "uuid"
label = "labels.erinnerung.bezug_id"

[entities.erinnerung.fields.faellig_am]
type = "date"
required = true
label = "labels.erinnerung.faellig_am"

[entities.erinnerung.fields.titel]
type = "string"
required = true
max_length = 200
label = "labels.erinnerung.titel"

[entities.erinnerung.fields.beschreibung]
type = "text"
label = "labels.erinnerung.beschreibung"

[entities.erinnerung.fields.status]
type = "enum"
required = true
options = ["offen", "erledigt", "zurueckgestellt"]
default = "offen"
label = "labels.erinnerung.status"

[entities.erinnerung.fields.erstellt_am]
type = "datetime"
auto_generate = true
label = "labels.common.erstellt_am"

[entities.kaution]
name = "kaution"
table_name = "kautionen"
label = "labels.entity.kaution"
label_plural = "labels.entity.kautionen"
icon = "Shield"
primary_key = "id"

[entities.kaution.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.kaution.fields.vertrag_id]
type = "uuid"
required = true
unique = true
reference = "vertrag"
label = "labels.kaution.vertrag"

[entities.kaution.fields.betrag]
type = "currency"
required = true
min = 0
label = "labels.kaution.betrag"

[entities.kaution.fields.eingangsdatum]
type = "date"
required = true
label = "labels.kaution.eingangsdatum"

[entities.kaution.fields.anlageform]
type = "enum"
required = true
options = ["sparbuch", "konto", "buergschaft", "bar"]
default = "konto"
label = "labels.kaution.anlageform"

[entities.kaution.fields.anlage_details]
type = "text"
label = "labels.kaution.anlage_details"
placeholder = "Bank, Kontonummer, etc."

[entities.kaution.fields.zinssatz]
type = "decimal"
min = 0
max = 10
precision = 2
suffix = "%"
label = "labels.kaution.zinssatz"

[entities.kaution.fields.status]
type = "enum"
required = true
options = ["angelegt", "teilrueckzahlung", "zurueckgezahlt"]
default = "angelegt"
label = "labels.kaution.status"

[entities.kaution.fields.rueckzahlungsdatum]
type = "date"
label = "labels.kaution.rueckzahlungsdatum"
visible_if = { field = "status", in = ["teilrueckzahlung", "zurueckgezahlt"] }

[entities.kaution.fields.rueckzahlungsbetrag]
type = "currency"
min = 0
label = "labels.kaution.rueckzahlungsbetrag"
visible_if = { field = "status", in = ["teilrueckzahlung", "zurueckgezahlt"] }

[entities.kaution.fields.einbehalt_grund]
type = "text"
label = "labels.kaution.einbehalt_grund"
visible_if = { field = "status", equals = "teilrueckzahlung" }

[entities.kaution.fields.notiz]
type = "text"
label = "labels.common.notiz"

[entities.kaution.relations]
vertrag = { type = "one_to_one", target = "vertrag", foreign_key = "vertrag_id" }

[entities.kostenart]
name = "kostenart"
table_name = "kostenarten"
label = "labels.entity.kostenart"
label_plural = "labels.entity.kostenarten"
icon = "Tag"
primary_key = "id"

[entities.kostenart.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.kostenart.fields.bezeichnung]
type = "string"
required = true
max_length = 100
label = "labels.kostenart.bezeichnung"

[entities.kostenart.fields.kategorie]
type = "enum"
required = true
options = ["umlagefaehig", "nicht_umlagefaehig"]
default = "umlagefaehig"
label = "labels.kostenart.kategorie"

[entities.kostenart.fields.umlageschluessel]
type = "enum"
required = true
options = ["flaeche", "personen", "einheiten", "verbrauch", "direkt"]
default = "flaeche"
label = "labels.kostenart.umlageschluessel"
description = "direkt = 1:1 Zuordnung zu Einheit"

[entities.kostenart.fields.nur_gewerbe]
type = "boolean"
default = false
label = "labels.kostenart.nur_gewerbe"

[entities.kostenart.fields.sortierung]
type = "integer"
default = 100
label = "labels.kostenart.sortierung"

[entities.kostenart.fields.aktiv]
type = "boolean"
default = true
label = "labels.kostenart.aktiv"

[entities.kostenart.relations]
rechnungen = { type = "one_to_many", target = "rechnung", foreign_key = "kostenart_id" }

[entities.mieter]
name = "mieter"
table_name = "mieter"
label = "labels.entity.mieter"
label_plural = "labels.entity.mieter_plural"
icon = "User"
primary_key = "id"

[entities.mieter.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.mieter.fields.anrede]
type = "enum"
options = ["herr", "frau", "firma", "divers"]
label = "labels.mieter.anrede"
placeholder = "herr"

[entities.mieter.fields.vorname]
type = "string"
max_length = 50
label = "labels.mieter.vorname"
required_if = { field = "anrede", not_in = ["firma"] }
placeholder = "Max"

[entities.mieter.fields.nachname]
type = "string"
required = true
max_length = 50
label = "labels.mieter.nachname"
description = "Bei Firma: Firmenname"
placeholder = "Mustermann"

[entities.mieter.fields.firma_zusatz]
type = "string"
max_length = 100
label = "labels.mieter.firma_zusatz"
visible_if = { field = "anrede", equals = "firma" }
placeholder = "Muster GmbH"

[entities.mieter.fields.geburtsdatum]
type = "date"
label = "labels.mieter.geburtsdatum"
visible_if = { field = "anrede", not_in = ["firma"] }

[entities.mieter.fields.telefon]
type = "string"
max_length = 30
label = "labels.mieter.telefon"
placeholder = "+49 170 1234567"

[entities.mieter.fields.email]
type = "email"
max_length = 100
label = "labels.mieter.email"
placeholder = "max@example.com"

[entities.mieter.fields.adresse_vorher]
type = "text"
label = "labels.mieter.adresse_vorher"
description = "Vorherige Anschrift"
placeholder = "Musterstraße 1, 12345 Berlin"

[entities.mieter.fields.iban]
type = "string"
max_length = 34
pattern = "^[A-Z]{2}[0-9]{2}[A-Z0-9]{1,30}$"
label = "labels.mieter.iban"
default = "DE"
placeholder = "DE12 3456 7890 1234 5678 90"

[entities.mieter.fields.bic]
type = "string"
max_length = 11
label = "labels.mieter.bic"
placeholder = "COBADEFFXXX"

[entities.mieter.fields.bankname]
type = "string"
max_length = 100
label = "labels.mieter.bankname"
placeholder = "Commerzbank Köln"

[entities.mieter.fields.status]
type = "enum"
required = true
options = ["aktiv", "gekuendigt", "ehemalig"]
default = "aktiv"
label = "labels.mieter.status"
placeholder = "aktiv"

[entities.mieter.fields.notiz]
type = "text"
label = "labels.common.notiz"
placeholder = "Hinweise zur Kommunikation"

[entities.mieter.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false
label = "labels.common.erstellt_am"

[entities.mieter.relations]
vertraege = { type = "one_to_many", target = "vertrag", foreign_key = "mieter_id" }
dokumente = { type = "one_to_many", target = "dokument", foreign_key = "mieter_id" }
zahlungen = { type = "one_to_many", target = "zahlung", foreign_key = "mieter_id", through = "vertrag" }

[entities.mieter.computed]
display_name = { formula = "concat(vorname, ' ', nachname)" }
aktiver_vertrag = { formula = "first(vertraege where ende is null or ende > now())" }
aktuelle_einheit = { formula = "aktiver_vertrag.einheit" }

[entities.nebenkostenabrechnung]
name = "nebenkostenabrechnung"
table_name = "nebenkostenabrechnungen"
label = "labels.entity.nebenkostenabrechnung"
label_plural = "labels.entity.nebenkostenabrechnungen"
icon = "FileSpreadsheet"
primary_key = "id"

[entities.nebenkostenabrechnung.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.nebenkostenabrechnung.fields.objekt_id]
type = "uuid"
required = true
reference = "objekt"
label = "labels.nk.objekt"

[entities.nebenkostenabrechnung.fields.jahr]
type = "integer"
required = true
min = 2000
max = 2100
label = "labels.nk.jahr"

[entities.nebenkostenabrechnung.fields.zeitraum_von]
type = "date"
required = true
label = "labels.nk.zeitraum_von"

[entities.nebenkostenabrechnung.fields.zeitraum_bis]
type = "date"
required = true
label = "labels.nk.zeitraum_bis"

[entities.nebenkostenabrechnung.fields.status]
type = "enum"
required = true
options = ["entwurf", "erstellt", "versendet"]
default = "entwurf"
label = "labels.nk.status"

[entities.nebenkostenabrechnung.fields.erstellt_am]
type = "datetime"
auto_generate = true
label = "labels.common.erstellt_am"

[entities.nebenkostenabrechnung.fields.notiz]
type = "text"
label = "labels.common.notiz"

[entities.nebenkostenabrechnung.relations]
objekt = { type = "many_to_one", target = "objekt", foreign_key = "objekt_id" }
positionen = { type = "one_to_many", target = "nebenkostenabrechnung_position", foreign_key = "abrechnung_id" }

[entities.nebenkostenabrechnung.computed]
gesamtkosten = { formula = "sum(positionen.gesamtkosten)" }

[entities.objekt]
name = "objekt"
table_name = "objekte"
label = "labels.entity.objekt"
label_plural = "labels.entity.objekte"
icon = "Building2"
primary_key = "id"

[entities.objekt.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.objekt.fields.bezeichnung]
type = "string"
required = true
max_length = 100
label = "labels.objekt.bezeichnung"
placeholder = "z.B. Haus Musterstraße 12"

[entities.objekt.fields.adresse]
type = "string"
required = true
max_length = 200
label = "labels.objekt.adresse"

[entities.objekt.fields.plz]
type = "string"
required = true
pattern = "^[0-9]{5}$"
label = "labels.objekt.plz"

[entities.objekt.fields.ort]
type = "string"
required = true
max_length = 100
label = "labels.objekt.ort"

[entities.objekt.fields.baujahr]
type = "integer"
min = 1800
max = 2100
label = "labels.objekt.baujahr"

[entities.objekt.fields.typ]
type = "enum"
required = true
options = ["wohnraum", "gewerbe", "gemischt"]
default = "wohnraum"
label = "labels.objekt.typ"

[entities.objekt.fields.ist_multi_einheit]
type = "boolean"
default = false
label = "labels.objekt.ist_multi_einheit"
description = "Mehrere Einheiten mit separaten Zählern"

[entities.objekt.fields.notiz]
type = "text"
label = "labels.common.notiz"

[entities.objekt.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false
label = "labels.common.erstellt_am"

[entities.objekt.relations]
einheiten = { type = "one_to_many", target = "einheit", foreign_key = "objekt_id" }
zaehler = { type = "one_to_many", target = "zaehler", foreign_key = "objekt_id" }
rechnungen = { type = "one_to_many", target = "rechnung", foreign_key = "objekt_id" }
dokumente = { type = "one_to_many", target = "dokument", foreign_key = "objekt_id" }

[entities.objekt.computed]
anzahl_einheiten = { formula = "count(einheiten)" }
anzahl_vermietet = { formula = "count(einheiten where status = 'vermietet')" }
leerstand = { formula = "anzahl_einheiten - anzahl_vermietet" }
gesamt_flaeche = { formula = "sum(einheiten.flaeche)" }

[entities.rechnung]
name = "rechnung"
table_name = "rechnungen"
label = "labels.entity.rechnung"
label_plural = "labels.entity.rechnungen"
icon = "Receipt"
primary_key = "id"

[entities.rechnung.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.rechnung.fields.objekt_id]
type = "uuid"
required = true
reference = "objekt"
label = "labels.rechnung.objekt"

[entities.rechnung.fields.kostenart_id]
type = "uuid"
required = true
reference = "kostenart"
label = "labels.rechnung.kostenart"

[entities.rechnung.fields.einheit_id]
type = "uuid"
reference = "einheit"
label = "labels.rechnung.einheit"
description = "Nur bei Direktzuordnung"
visible_if = { field = "kostenart.umlageschluessel", equals = "direkt" }

[entities.rechnung.fields.rechnungsnummer]
type = "string"
max_length = 50
label = "labels.rechnung.rechnungsnummer"

[entities.rechnung.fields.rechnungsdatum]
type = "date"
required = true
label = "labels.rechnung.rechnungsdatum"

[entities.rechnung.fields.faelligkeitsdatum]
type = "date"
label = "labels.rechnung.faelligkeitsdatum"

[entities.rechnung.fields.betrag]
type = "currency"
required = true
min = 0
label = "labels.rechnung.betrag"

[entities.rechnung.fields.zeitraum_von]
type = "date"
label = "labels.rechnung.zeitraum_von"

[entities.rechnung.fields.zeitraum_bis]
type = "date"
label = "labels.rechnung.zeitraum_bis"

[entities.rechnung.fields.bezahlt_am]
type = "date"
label = "labels.rechnung.bezahlt_am"

[entities.rechnung.fields.dokument_id]
type = "uuid"
reference = "dokument"
label = "labels.rechnung.dokument"

[entities.rechnung.fields.notiz]
type = "text"
label = "labels.common.notiz"

[entities.rechnung.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false

[entities.rechnung.relations]
objekt = { type = "many_to_one", target = "objekt", foreign_key = "objekt_id" }
kostenart = { type = "many_to_one", target = "kostenart", foreign_key = "kostenart_id" }
einheit = { type = "many_to_one", target = "einheit", foreign_key = "einheit_id" }
dokument = { type = "many_to_one", target = "dokument", foreign_key = "dokument_id" }

[entities.rechnung.computed]
ist_bezahlt = { formula = "bezahlt_am is not null" }
jahr = { formula = "year(rechnungsdatum)" }

[entities.sollstellung]
name = "sollstellung"
table_name = "sollstellungen"
label = "labels.entity.sollstellung"
label_plural = "labels.entity.sollstellungen"
icon = "ListChecks"
primary_key = "id"

[entities.sollstellung.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.sollstellung.fields.vertrag_id]
type = "uuid"
required = true
reference = "vertrag"
label = "labels.sollstellung.vertrag"

[entities.sollstellung.fields.monat]
type = "string"
required = true
pattern = "^[0-9]{4}-[0-9]{2}$"
label = "labels.sollstellung.monat"

[entities.sollstellung.fields.sollbetrag]
type = "currency"
required = true
label = "labels.sollstellung.sollbetrag"

[entities.sollstellung.fields.istbetrag]
type = "currency"
default = 0
label = "labels.sollstellung.istbetrag"

[entities.sollstellung.fields.status]
type = "enum"
options = ["offen", "teilweise", "bezahlt", "ueberzahlt"]
default = "offen"
label = "labels.sollstellung.status"

[entities.sollstellung.relations]
vertrag = { type = "many_to_one", target = "vertrag", foreign_key = "vertrag_id" }

[entities.sollstellung.computed]
differenz = { formula = "istbetrag - sollbetrag" }
mieter = { formula = "vertrag.mieter" }

[entities.vertrag]
name = "vertrag"
table_name = "vertraege"
label = "labels.entity.vertrag"
label_plural = "labels.entity.vertraege"
icon = "FileSignature"
primary_key = "id"

[entities.vertrag.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.vertrag.fields.einheit_id]
type = "uuid"
required = true
reference = "einheit"
label = "labels.vertrag.einheit"

[entities.vertrag.fields.mieter_id]
type = "uuid"
required = true
reference = "mieter"
label = "labels.vertrag.mieter"

[entities.vertrag.fields.vertragsnummer]
type = "string"
max_length = 30
label = "labels.vertrag.vertragsnummer"

[entities.vertrag.fields.typ]
type = "enum"
required = true
options = ["wohnraum", "gewerbe"]
label = "labels.vertrag.typ"
auto_from = "einheit.objekt.typ"

[entities.vertrag.fields.beginn]
type = "date"
required = true
label = "labels.vertrag.beginn"

[entities.vertrag.fields.ende]
type = "date"
label = "labels.vertrag.ende"
description = "Leer = unbefristet"

[entities.vertrag.fields.kuendigungsfrist]
type = "integer"
default = 3
min = 1
max = 12
suffix = "Monate"
label = "labels.vertrag.kuendigungsfrist"

[entities.vertrag.fields.kuendigung_zum]
type = "date"
label = "labels.vertrag.kuendigung_zum"

[entities.vertrag.fields.gekuendigt_von]
type = "enum"
options = ["mieter", "vermieter"]
label = "labels.vertrag.gekuendigt_von"
visible_if = { field = "kuendigung_zum", is_set = true }

# === Mietkonditionen ===

[entities.vertrag.fields.kaltmiete]
type = "currency"
required = true
min = 0
label = "labels.vertrag.kaltmiete"

[entities.vertrag.fields.nebenkosten_vorauszahlung]
type = "currency"
required = true
min = 0
default = 0
label = "labels.vertrag.nebenkosten_vorauszahlung"

[entities.vertrag.fields.heizkosten_vorauszahlung]
type = "currency"
min = 0
default = 0
label = "labels.vertrag.heizkosten_vorauszahlung"

[entities.vertrag.fields.sonstige_vorauszahlung]
type = "currency"
min = 0
default = 0
label = "labels.vertrag.sonstige_vorauszahlung"
description = "z.B. Stellplatz, Garage"

# === Mieterhöhung ===

[entities.vertrag.fields.mietanpassung_typ]
type = "enum"
options = ["keine", "mietspiegel", "staffel", "index"]
default = "mietspiegel"
label = "labels.vertrag.mietanpassung_typ"
visible_if = { field = "typ", equals = "wohnraum" }

[entities.vertrag.fields.staffelmiete]
type = "json"
label = "labels.vertrag.staffelmiete"
description = "Array: [{ab: date, kaltmiete: number}]"
visible_if = { field = "mietanpassung_typ", equals = "staffel" }

[entities.vertrag.fields.indexmiete]
type = "json"
label = "labels.vertrag.indexmiete"
description = "{basisjahr, basisindex, schwelle_prozent}"
visible_if = { field = "mietanpassung_typ", equals = "index" }

[entities.vertrag.fields.letzte_mieterhoehung]
type = "date"
label = "labels.vertrag.letzte_mieterhoehung"

[entities.vertrag.fields.notiz]
type = "text"
label = "labels.common.notiz"

[entities.vertrag.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false

[entities.vertrag.relations]
einheit = { type = "many_to_one", target = "einheit", foreign_key = "einheit_id" }
mieter = { type = "many_to_one", target = "mieter", foreign_key = "mieter_id" }
kaution = { type = "one_to_one", target = "kaution", foreign_key = "vertrag_id" }
zahlungen = { type = "one_to_many", target = "zahlung", foreign_key = "vertrag_id" }
sollstellungen = { type = "one_to_many", target = "sollstellung", foreign_key = "vertrag_id" }

[entities.vertrag.computed]
gesamtmiete = { formula = "kaltmiete + nebenkosten_vorauszahlung + heizkosten_vorauszahlung + sonstige_vorauszahlung" }
ist_aktiv = { formula = "(ende is null or ende > now()) and kuendigung_zum is null" }
ist_gekuendigt = { formula = "kuendigung_zum is not null" }
naechste_mieterhoehung_moeglich = { formula = "add_months(letzte_mieterhoehung, 15)" }

[entities.vertrag.validation]
ende_nach_beginn = { rule = "ende is null or ende > beginn", message = "labels.validation.ende_nach_beginn" }
kuendigung_logik = { rule = "kuendigung_zum is null or gekuendigt_von is not null", message = "labels.validation.kuendigung_von_fehlt" }

[entities.zaehler]
name = "zaehler"
table_name = "zaehler"
label = "labels.entity.zaehler"
label_plural = "labels.entity.zaehler_plural"
icon = "Gauge"
primary_key = "id"

[entities.zaehler.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.zaehler.fields.objekt_id]
type = "uuid"
required = true
reference = "objekt"
label = "labels.zaehler.objekt"

[entities.zaehler.fields.einheit_id]
type = "uuid"
reference = "einheit"
label = "labels.zaehler.einheit"
description = "Leer = Hauptzähler"

[entities.zaehler.fields.typ]
type = "enum"
required = true
options = ["strom", "gas", "wasser", "heizung", "warmwasser"]
label = "labels.zaehler.typ"

[entities.zaehler.fields.zaehlernummer]
type = "string"
required = true
max_length = 50
label = "labels.zaehler.zaehlernummer"

[entities.zaehler.fields.ist_hauptzaehler]
type = "boolean"
default = false
label = "labels.zaehler.ist_hauptzaehler"

[entities.zaehler.fields.messeinheit]
type = "enum"
required = true
options = ["kWh", "m3"]
label = "labels.zaehler.messeinheit"
auto_from_typ = { strom = "kWh", gas = "m3", wasser = "m3", heizung = "kWh", warmwasser = "m3" }

[entities.zaehler.fields.notiz]
type = "text"
label = "labels.common.notiz"

[entities.zaehler.relations]
objekt = { type = "many_to_one", target = "objekt", foreign_key = "objekt_id" }
einheit = { type = "many_to_one", target = "einheit", foreign_key = "einheit_id" }
staende = { type = "one_to_many", target = "zaehlerstand", foreign_key = "zaehler_id" }

[entities.zaehler.computed]
letzter_stand = { formula = "last(staende order by datum)" }
bezeichnung_display = { formula = "concat(typ, ' - ', zaehlernummer, ist_hauptzaehler ? ' (Haupt)' : '')" }

[entities.zaehlerstand]
name = "zaehlerstand"
table_name = "zaehlerstaende"
label = "labels.entity.zaehlerstand"
label_plural = "labels.entity.zaehlerstaende"
icon = "Activity"
primary_key = "id"

[entities.zaehlerstand.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.zaehlerstand.fields.zaehler_id]
type = "uuid"
required = true
reference = "zaehler"
label = "labels.zaehlerstand.zaehler"
visible_in_form = false

[entities.zaehlerstand.fields.datum]
type = "date"
required = true
label = "labels.zaehlerstand.datum"

[entities.zaehlerstand.fields.stand]
type = "decimal"
required = true
min = 0
precision = 2
label = "labels.zaehlerstand.stand"

[entities.zaehlerstand.fields.ableseart]
type = "enum"
required = true
options = ["selbst", "versorger", "schaetzung"]
default = "selbst"
label = "labels.zaehlerstand.ableseart"

[entities.zaehlerstand.fields.foto]
type = "file"
accept = ["image/jpeg", "image/png"]
label = "labels.zaehlerstand.foto"

[entities.zaehlerstand.fields.notiz]
type = "text"
label = "labels.common.notiz"

[entities.zaehlerstand.relations]
zaehler = { type = "many_to_one", target = "zaehler", foreign_key = "zaehler_id" }

[entities.zaehlerstand.computed]
verbrauch = { formula = "stand - previous(stand)" }

[entities.zahlung]
name = "zahlung"
table_name = "zahlungen"
label = "labels.entity.zahlung"
label_plural = "labels.entity.zahlungen"
icon = "ArrowDownCircle"
primary_key = "id"

[entities.zahlung.fields.id]
type = "uuid"
auto_generate = true
visible = false

[entities.zahlung.fields.vertrag_id]
type = "uuid"
required = true
reference = "vertrag"
label = "labels.zahlung.vertrag"

[entities.zahlung.fields.datum]
type = "date"
required = true
label = "labels.zahlung.datum"

[entities.zahlung.fields.betrag]
type = "currency"
required = true
label = "labels.zahlung.betrag"

[entities.zahlung.fields.verwendungszweck]
type = "string"
max_length = 200
label = "labels.zahlung.verwendungszweck"

[entities.zahlung.fields.typ]
type = "enum"
required = true
options = ["miete", "nachzahlung", "kaution", "sonstig"]
default = "miete"
label = "labels.zahlung.typ"

[entities.zahlung.fields.monat_fuer]
type = "string"
pattern = "^[0-9]{4}-[0-9]{2}$"
label = "labels.zahlung.monat_fuer"
placeholder = "YYYY-MM"
visible_if = { field = "typ", equals = "miete" }

[entities.zahlung.fields.notiz]
type = "text"
label = "labels.common.notiz"

[entities.zahlung.fields.erstellt_am]
type = "datetime"
auto_generate = true
visible_in_form = false

[entities.zahlung.relations]
vertrag = { type = "many_to_one", target = "vertrag", foreign_key = "vertrag_id" }

[entities.zahlung.computed]
mieter = { formula = "vertrag.mieter" }
einheit = { formula = "vertrag.einheit" }

[forms.dokument.form]
entity = "dokument"
title_create = "labels.form.dokument_hochladen"
title_edit = "labels.form.dokument_bearbeiten"

[[form.sections]]
id = "zuordnung"
label = "labels.form.section.zuordnung"

  [[form.sections.fields]]
  field = "objekt_id"
  width = "half"
  allow_clear = true

  [[form.sections.fields]]
  field = "einheit_id"
  width = "half"
  allow_clear = true

  [[form.sections.fields]]
  field = "mieter_id"
  width = "half"
  allow_clear = true

  [[form.sections.fields]]
  field = "vertrag_id"
  width = "half"
  allow_clear = true

[[form.sections]]
id = "detail"
label = "labels.form.section.details"

  [[form.sections.fields]]
  field = "typ"
  width = "half"

  [[form.sections.fields]]
  field = "bezeichnung"
  width = "half"

  [[form.sections.fields]]
  field = "datum"
  width = "third"

  [[form.sections.fields]]
  field = "jahr"
  width = "third"

  [[form.sections.fields]]
  field = "hochgeladen_am"
  width = "third"
  readonly = true

[[form.sections]]
id = "datei"
label = "labels.form.section.datei"

  [[form.sections.fields]]
  field = "dateiname"
  width = "half"

  [[form.sections.fields]]
  field = "dateipfad"
  width = "half"
  readonly = true

  [[form.sections.fields]]
  field = "dateigroesse"
  width = "half"
  readonly = true

  [[form.sections.fields]]
  field = "mime_type"
  width = "half"
  readonly = true

[[form.sections]]
id = "notiz"

  [[form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.dokument.form.actions]
save_label = "labels.actions.speichern"
cancel_label = "labels.actions.abbrechen"

[forms.einheit.form]
entity = "einheit"
title_create = "labels.actions.add"
title_edit = "labels.actions.edit"

[[form.sections]]
id = "basis"
label = "labels.form.section.basic"

  [[form.sections.fields]]
  field = "objekt_id"
  width = "full"

  [[form.sections.fields]]
  field = "bezeichnung"
  width = "half"

  [[form.sections.fields]]
  field = "typ"
  width = "half"

[[form.sections]]
id = "details"
label = "labels.form.section.details"

  [[form.sections.fields]]
  field = "flaeche"
  width = "half"

  [[form.sections.fields]]
  field = "anzahl_raeume"
  width = "half"

  [[form.sections.fields]]
  field = "etage"
  placeholder = "2. OG"
  width = "half"

[[form.sections]]
id = "ausstattung"
label = "labels.form.section.settings"

  [[form.sections.fields]]
  field = "ausstattung"
  width = "full"

  [[form.sections.fields]]
  field = "status"
  width = "half"

[[form.sections]]
id = "notizen"
label = "labels.form.section.notes"

  [[form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.einheit.form.actions]
submit = { label = "labels.buttons.save" }
cancel = { label = "labels.buttons.cancel" }

[forms.kaution.form]
entity = "kaution"
title_create = "labels.form.kaution_anlegen"
title_edit = "labels.form.kaution_bearbeiten"

[[form.sections]]
id = "daten"
label = "labels.form.section.allgemein"

  [[form.sections.fields]]
  field = "vertrag_id"
  width = "full"

  [[form.sections.fields]]
  field = "betrag"
  width = "half"

  [[form.sections.fields]]
  field = "eingangsdatum"
  width = "half"

  [[form.sections.fields]]
  field = "anlageform"
  width = "full"

[[form.sections]]
id = "details"
label = "labels.form.section.kaution"

  [[form.sections.fields]]
  field = "anlage_details"
  width = "full"
  rows = 2

  [[form.sections.fields]]
  field = "zinssatz"
  width = "half"

  [[form.sections.fields]]
  field = "status"
  width = "half"

  [[form.sections.fields]]
  field = "rueckzahlungsdatum"
  width = "half"

  [[form.sections.fields]]
  field = "rueckzahlungsbetrag"
  width = "half"

  [[form.sections.fields]]
  field = "einbehalt_grund"
  width = "full"
  rows = 2

[forms.mieter.form]
entity = "mieter"
title_create = "labels.actions.add"
title_edit = "labels.actions.edit"

[[form.sections]]
id = "basis"
label = "labels.form.section.basic"

  [[form.sections.fields]]
  field = "anrede"
  width = "half"

  [[form.sections.fields]]
  field = "vorname"
  width = "half"

  [[form.sections.fields]]
  field = "nachname"
  width = "full"

  [[form.sections.fields]]
  field = "firma_zusatz"
  width = "full"

[[form.sections]]
id = "kontakt"
label = "labels.form.section.contact"

  [[form.sections.fields]]
  field = "email"
  width = "full"

  [[form.sections.fields]]
  field = "telefon"
  width = "half"

  [[form.sections.fields]]
  field = "mobil"
  width = "half"

  [[form.sections.fields]]
  field = "status"
  width = "half"

[[form.sections]]
id = "adressen"
label = "labels.form.section.addresses"

  [[form.sections.fields]]
  field = "adresse_vorher"
  width = "full"

[[form.sections]]
id = "banking"
label = "labels.form.section.financial"

  [[form.sections.fields]]
  field = "iban"
  width = "full"

  [[form.sections.fields]]
  field = "bic"
  width = "half"

  [[form.sections.fields]]
  field = "bankname"
  width = "half"

[[form.sections]]
id = "notizen"
label = "labels.form.section.notes"

  [[form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.mieter.form.actions]
submit = { label = "labels.buttons.save" }
cancel = { label = "labels.buttons.cancel" }

[forms.nebenkostenabrechnung.form]
entity = "nebenkostenabrechnung"
title_create = "labels.form.nk_abrechnung_erstellen"
title_edit = "labels.form.nk_abrechnung_bearbeiten"

[[form.sections]]
id = "basis"
label = "labels.form.section.nk_abrechnung"

  [[form.sections.fields]]
  field = "objekt_id"
  width = "full"

  [[form.sections.fields]]
  field = "jahr"
  width = "half"

  [[form.sections.fields]]
  field = "zeitraum_von"
  width = "half"

  [[form.sections.fields]]
  field = "zeitraum_bis"
  width = "half"

  [[form.sections.fields]]
  field = "status"
  width = "half"

[[form.sections]]
id = "notiz"
label = "labels.form.section.notizen"

  [[form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.objekt.form]
entity = "objekt"
title_create = "labels.form.objekt_anlegen"
title_edit = "labels.form.objekt_bearbeiten"

[[form.sections]]
id = "basis"
label = "labels.form.section.basis"

  [[form.sections.fields]]
  field = "bezeichnung"
  width = "full"

  [[form.sections.fields]]
  field = "typ"
  width = "half"

  [[form.sections.fields]]
  field = "ist_multi_einheit"
  width = "half"

[[form.sections]]
id = "adresse"
label = "labels.form.section.adresse"

  [[form.sections.fields]]
  field = "adresse"
  width = "full"

  [[form.sections.fields]]
  field = "plz"
  width = "third"

  [[form.sections.fields]]
  field = "ort"
  width = "two_thirds"

[[form.sections]]
id = "details"
label = "labels.form.section.details"

  [[form.sections.fields]]
  field = "baujahr"
  width = "half"

  [[form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.objekt.form.actions]
submit = { label = "labels.actions.speichern" }
cancel = { label = "labels.actions.abbrechen" }

[forms.rechnung.form]
entity = "rechnung"
title_create = "labels.form.rechnung_erfassen"
title_edit = "labels.form.rechnung_bearbeiten"

[[form.sections]]
id = "metadata"
label = "labels.form.section.rechnung"

  [[form.sections.fields]]
  field = "objekt_id"
  width = "full"

  [[form.sections.fields]]
  field = "kostenart_id"
  width = "full"

  [[form.sections.fields]]
  field = "einheit_id"
  width = "full"

[[form.sections]]
id = "zeiträume"
label = "labels.form.section.zeitraum"

  [[form.sections.fields]]
  field = "rechnungsnummer"
  width = "half"

  [[form.sections.fields]]
  field = "rechnungsdatum"
  width = "half"

  [[form.sections.fields]]
  field = "faelligkeitsdatum"
  width = "half"

  [[form.sections.fields]]
  field = "zeitraum_von"
  width = "half"

  [[form.sections.fields]]
  field = "zeitraum_bis"
  width = "half"

[[form.sections]]
id = "betrag"
label = "labels.form.section.betrag"

  [[form.sections.fields]]
  field = "betrag"
  width = "half"

  [[form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.sollstellung.form]
entity = "sollstellung"
title_create = "labels.form.sollstellung_anlegen"
title_edit = "labels.form.sollstellung_bearbeiten"

[[form.sections]]
id = "zeitraum"
label = "labels.form.section.sollstellung"

  [[form.sections.fields]]
  field = "vertrag_id"
  width = "full"

  [[form.sections.fields]]
  field = "monat"
  width = "half"

  [[form.sections.fields]]
  field = "sollbetrag"
  width = "half"

  [[form.sections.fields]]
  field = "istbetrag"
  width = "half"

  [[form.sections.fields]]
  field = "status"
  width = "half"

[forms.vertrag.form]
entity = "vertrag"
title_create = "labels.form.vertrag_anlegen"
title_edit = "labels.form.vertrag_bearbeiten"

[[form.sections]]
id = "zuordnung"
label = "labels.form.section.zuordnung"

  [[form.sections.fields]]
  field = "einheit_id"
  width = "half"
  filter = { status = "leer" }
  include_current = true

  [[form.sections.fields]]
  field = "mieter_id"
  width = "half"
  allow_create = true

  [[form.sections.fields]]
  field = "vertragsnummer"
  width = "half"

  [[form.sections.fields]]
  field = "typ"
  width = "half"

[[form.sections]]
id = "laufzeit"
label = "labels.form.section.laufzeit"

  [[form.sections.fields]]
  field = "beginn"
  width = "third"

  [[form.sections.fields]]
  field = "ende"
  width = "third"

  [[form.sections.fields]]
  field = "kuendigungsfrist"
  width = "third"

[[form.sections]]
id = "miete"
label = "labels.form.section.miete"

  [[form.sections.fields]]
  field = "kaltmiete"
  width = "half"

  [[form.sections.fields]]
  field = "nebenkosten_vorauszahlung"
  width = "half"

  [[form.sections.fields]]
  field = "heizkosten_vorauszahlung"
  width = "half"

  [[form.sections.fields]]
  field = "sonstige_vorauszahlung"
  width = "half"

  [form.sections.computed_display]
  field = "computed.gesamtmiete"
  label = "labels.vertrag.gesamtmiete"
  format = "currency"
  highlight = true

[[form.sections]]
id = "anpassung"
label = "labels.form.section.mietanpassung"
collapsible = true

  [[form.sections.fields]]
  field = "mietanpassung_typ"
  width = "half"

  [[form.sections.fields]]
  field = "letzte_mieterhoehung"
  width = "half"

  [[form.sections.fields]]
  field = "staffelmiete"
  width = "full"
  component = "StaffelmieteEditor"

  [[form.sections.fields]]
  field = "indexmiete"
  width = "full"
  component = "IndexmieteEditor"

[[form.sections]]
id = "sonstiges"

  [[form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.vertrag.form.on_save]
actions = [
  { action = "update_einheit_status", target = "einheit_id", set = { status = "vermietet" } },
  { action = "update_mieter_status", target = "mieter_id", set = { status = "aktiv" } },
  { action = "generate_sollstellungen", from = "beginn" }
]

[forms.zaehler.form]
entity = "zaehler"
title_create = "labels.form.zaehler_anlegen"
title_edit = "labels.form.zaehler_bearbeiten"

[[form.sections]]
id = "zuordnung"
label = "labels.form.section.zaehler_zuordnung"

  [[form.sections.fields]]
  field = "objekt_id"
  width = "full"

  [[form.sections.fields]]
  field = "einheit_id"
  width = "full"
  description = "Nur für Unterzähler"

[[form.sections]]
id = "details"
label = "labels.form.section.zaehler_details"

  [[form.sections.fields]]
  field = "typ"
  width = "half"

  [[form.sections.fields]]
  field = "messeinheit"
  width = "half"

  [[form.sections.fields]]
  field = "zaehlernummer"
  width = "half"

  [[form.sections.fields]]
  field = "ist_hauptzaehler"
  width = "half"

[[form.sections]]
id = "zusatz"
label = "labels.form.section.zaehler_zusatz"

  [[form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.zaehlerstand.form]
entity = "zaehlerstand"
title_create = "labels.form.zaehlerstand_erfassen"
title_edit = "labels.form.zaehlerstand_bearbeiten"

[[form.sections]]
id = "basis"
label = "labels.form.section.zaehlerstand"

  [[form.sections.fields]]
  field = "zaehler_id"
  width = "full"
  hidden = true

  [[form.sections.fields]]
  field = "datum"
  width = "half"

  [[form.sections.fields]]
  field = "stand"
  width = "half"

  [[form.sections.fields]]
  field = "ableseart"
  width = "half"

  [[form.sections.fields]]
  field = "foto"
  width = "half"

  [[form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 3

[forms.zahlung.form]
entity = "zahlung"
title_create = "labels.form.zahlung_erfassen"
title_edit = "labels.form.zahlung_bearbeiten"

[[form.sections]]
id = "basis"
label = "labels.form.section.zahlung"

  [[form.sections.fields]]
  field = "vertrag_id"
  width = "full"

  [[form.sections.fields]]
  field = "datum"
  width = "half"

  [[form.sections.fields]]
  field = "betrag"
  width = "half"

  [[form.sections.fields]]
  field = "typ"
  width = "half"

  [[form.sections.fields]]
  field = "monat_fuer"
  width = "half"

  [[form.sections.fields]]
  field = "verwendungszweck"
  width = "full"
  rows = 2

  [[form.sections.fields]]
  field = "notiz"
  width = "full"
  rows = 2

[tables.abrechnungen.table]
entity = "nebenkostenabrechnung"

[[tables.abrechnungen.table.columns]]
field = "objekt.bezeichnung"
label = "labels.nk.objekt"
sortable = true
width = "20%"

[[tables.abrechnungen.table.columns]]
field = "jahr"
label = "labels.nk.jahr"
sortable = true
width = "12%"

[[tables.abrechnungen.table.columns]]
field = "zeitraum_von"
label = "labels.nk.zeitraum"
width = "18%"
template = "{zeitraum_von|date} – {zeitraum_bis|date}"

[[tables.abrechnungen.table.columns]]
field = "status"
label = "labels.nk.status"
width = "15%"
display = "badge"

[[tables.abrechnungen.table.columns]]
field = "gesamtkosten"
label = "labels.nk.gesamtkosten"
width = "15%"
format = "currency"

[tables.abrechnungen.table.row_actions]
details = { icon = "Search", dialog = "dialogs/nk_abrechnung_detail" }

[tables.dokumente.table]
entity = "dokument"
selectable = true

[[tables.dokumente.table.columns]]
field = "bezeichnung"
label = "labels.dokument.bezeichnung"
sortable = true
width = "25%"

[[tables.dokumente.table.columns]]
field = "typ"
label = "labels.dokument.typ"
sortable = true
width = "10%"
display = "badge"

[[tables.dokumente.table.columns]]
field = "objekt.bezeichnung"
label = "labels.dokument.objekt"
sortable = true
width = "15%"
empty_text = "—"

[[tables.dokumente.table.columns]]
field = "mieter.computed.display_name"
label = "labels.dokument.mieter"
width = "15%"
empty_text = "—"

[[tables.dokumente.table.columns]]
field = "datum"
label = "labels.dokument.datum"
sortable = true
width = "10%"
format = "date"

[[tables.dokumente.table.columns]]
field = "jahr"
label = "labels.dokument.jahr"
sortable = true
width = "8%"

[[tables.dokumente.table.columns]]
field = "hochgeladen_am"
label = "labels.dokument.hochgeladen"
sortable = true
width = "12%"
format = "datetime"

[tables.dokumente.table.row_actions]
preview = { icon = "Eye", handler = "dokument.preview" }
download = { icon = "Download", handler = "dokument.download" }
edit = { icon = "Pencil", dialog = "forms/dokument.form" }
delete = { icon = "Trash2", confirm = true }

[tables.einheiten.table]
entity = "einheit"
row_click = "expand"

[[tables.einheiten.table.columns]]
field = "bezeichnung"
label = "labels.einheit.bezeichnung"
sortable = true
width = "25%"

[[tables.einheiten.table.columns]]
field = "typ"
label = "labels.einheit.typ"
sortable = true
width = "15%"
display = "badge"

[[tables.einheiten.table.columns]]
field = "flaeche"
label = "labels.einheit.flaeche"
sortable = true
width = "10%"
format = "number"
suffix = " m²"

[[tables.einheiten.table.columns]]
field = "computed.aktueller_mieter.computed.display_name"
label = "labels.einheit.mieter"
width = "25%"
empty_text = "—"

[[tables.einheiten.table.columns]]
field = "status"
label = "labels.einheit.status"
sortable = true
width = "15%"
display = "badge"
badge_colors = { vermietet = "green", leer = "red", eigennutzung = "blue", renovierung = "yellow" }

[tables.einheiten.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/einheit.form" }
vertrag = { icon = "FileSignature", dialog = "forms/vertrag.form", visible_if = { field = "status", equals = "leer" }, label = "labels.actions.vertrag_anlegen" }

[tables.kautionen.table]
entity = "kaution"

[[tables.kautionen.table.columns]]
field = "vertrag.mieter.computed.display_name"
label = "labels.kaution.mieter"
sortable = true
width = "25%"

[[tables.kautionen.table.columns]]
field = "vertrag.einheit.bezeichnung"
label = "labels.kaution.einheit"
sortable = true
width = "20%"

[[tables.kautionen.table.columns]]
field = "betrag"
label = "labels.kaution.betrag"
sortable = true
width = "15%"
format = "currency"

[[tables.kautionen.table.columns]]
field = "eingangsdatum"
label = "labels.kaution.eingangsdatum"
sortable = true
width = "15%"
format = "date"

[[tables.kautionen.table.columns]]
field = "status"
label = "labels.kaution.status"
width = "15%"
display = "badge"

[[tables.kautionen.table.columns]]
field = "rueckzahlungsdatum"
label = "labels.kaution.rueckzahlungsdatum"
width = "10%"
format = "date"

[tables.kautionen.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/kaution.form" }
delete = { icon = "Trash2", confirm = true }

[tables.mieter.table]
entity = "mieter"
row_click = "navigate"
row_click_route = "/mieter/:id"

[[tables.mieter.table.columns]]
field = "computed.display_name"
label = "labels.mieter.name"
sortable = true
sort_field = "nachname"
width = "25%"
template = "{vorname} {nachname}"

[[tables.mieter.table.columns]]
field = "mobil"
fallback_fields = ["telefon"]
label = "labels.mieter.telefon"
width = "15%"

[[tables.mieter.table.columns]]
field = "email"
label = "labels.mieter.email"
width = "20%"

[[tables.mieter.table.columns]]
field = "computed.aktuelle_einheit.bezeichnung"
label = "labels.mieter.einheit"
width = "20%"
empty_text = "—"

[[tables.mieter.table.columns]]
field = "status"
label = "labels.mieter.status"
sortable = true
width = "10%"
display = "badge"
badge_colors = { aktiv = "green", gekuendigt = "yellow", ehemalig = "gray" }

[tables.mieter.table.actions]
label = "labels.table.actions"
width = "8rem"

[tables.mieter.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/mieter.form", label = "" }
vertrag = { icon = "FileSignature", label = "", handler = "navigate_vertrag" }
einheit = { icon = "Home", label = "", handler = "navigate_einheit" }

[tables.objekte.table]
entity = "objekt"
row_click = "navigate"
row_click_route = "/objekte/:id"

[[tables.objekte.table.columns]]
field = "bezeichnung"
label = "labels.objekt.bezeichnung"
sortable = true
width = "25%"

[[tables.objekte.table.columns]]
field = "adresse"
label = "labels.objekt.adresse"
sortable = true
width = "30%"
template = "{adresse}, {plz} {ort}"

[[tables.objekte.table.columns]]
field = "typ"
label = "labels.objekt.typ"
sortable = true
width = "10%"
display = "badge"
badge_colors = { wohnraum = "blue", gewerbe = "orange", gemischt = "purple" }

[[tables.objekte.table.columns]]
field = "computed.anzahl_einheiten"
label = "labels.objekt.einheiten"
sortable = true
width = "10%"
align = "center"

[[tables.objekte.table.columns]]
field = "computed.leerstand"
label = "labels.objekt.leerstand"
sortable = true
width = "10%"
align = "center"
highlight_if = { condition = "> 0", color = "yellow" }

[[tables.objekte.table.columns]]
field = "computed.gesamt_flaeche"
label = "labels.objekt.flaeche"
sortable = true
width = "15%"
format = "number"
suffix = " m²"

[tables.objekte.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/objekt.form" }
delete = { icon = "Trash2", confirm = true, confirm_message = "labels.confirm.objekt_loeschen" }

[tables.rechnungen.table]
entity = "rechnung"

[[tables.rechnungen.table.columns]]
field = "rechnungsdatum"
label = "labels.rechnung.datum"
sortable = true
width = "10%"
format = "date"

[[tables.rechnungen.table.columns]]
field = "objekt.bezeichnung"
label = "labels.rechnung.objekt"
sortable = true
width = "18%"

[[tables.rechnungen.table.columns]]
field = "kostenart.bezeichnung"
label = "labels.rechnung.kostenart"
sortable = true
width = "15%"

[[tables.rechnungen.table.columns]]
field = "rechnungsnummer"
label = "labels.rechnung.nummer"
width = "12%"

[[tables.rechnungen.table.columns]]
field = "betrag"
label = "labels.rechnung.betrag"
sortable = true
width = "12%"
format = "currency"

[[tables.rechnungen.table.columns]]
field = "zeitraum_von"
label = "labels.rechnung.zeitraum"
width = "15%"
template = "{zeitraum_von|date} - {zeitraum_bis|date}"

[[tables.rechnungen.table.columns]]
field = "computed.ist_bezahlt"
label = "labels.rechnung.bezahlt"
sortable = true
width = "8%"
display = "boolean_icon"
icons = { true = "Check", false = "X" }

[[tables.rechnungen.table.columns]]
field = "dokument_id"
label = ""
width = "5%"
display = "icon_link"
icon = "FileText"
visible_if = { field = "dokument_id", is_set = true }
click = "preview_document"

[tables.rechnungen.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/rechnung.form" }
bezahlen = { icon = "CheckCircle", handler = "rechnung.markAsPaid", visible_if = { field = "computed.ist_bezahlt", equals = false } }
dokument = { icon = "Upload", dialog = "forms/dokument.form", defaults = { objekt_id = ":objekt_id" } }

[tables.sollstellungen.table]
entity = "sollstellung"

[[tables.sollstellungen.table.columns]]
field = "monat"
label = "labels.sollstellung.monat"
sortable = true
width = "12%"
format = "month"

[[tables.sollstellungen.table.columns]]
field = "vertrag.mieter.computed.display_name"
label = "labels.sollstellung.mieter"
sortable = true
width = "22%"

[[tables.sollstellungen.table.columns]]
field = "vertrag.einheit.bezeichnung"
label = "labels.sollstellung.einheit"
width = "18%"

[[tables.sollstellungen.table.columns]]
field = "sollbetrag"
label = "labels.sollstellung.soll"
sortable = true
width = "12%"
format = "currency"

[[tables.sollstellungen.table.columns]]
field = "istbetrag"
label = "labels.sollstellung.ist"
sortable = true
width = "12%"
format = "currency"

[[tables.sollstellungen.table.columns]]
field = "computed.differenz"
label = "labels.sollstellung.differenz"
sortable = true
width = "12%"
format = "currency"
color_rule = { negative = "red", positive = "green", zero = "inherit" }

[[tables.sollstellungen.table.columns]]
field = "status"
label = "labels.sollstellung.status"
sortable = true
width = "12%"
display = "badge"
badge_colors = { offen = "red", teilweise = "yellow", bezahlt = "green", ueberzahlt = "blue" }

[tables.sollstellungen.table.row_actions]
zahlung = { icon = "Plus", dialog = "forms/zahlung.form", defaults = { vertrag_id = ":vertrag_id", monat_fuer = ":monat" } }

[tables.vertraege.table]
entity = "vertrag"
row_click = "navigate"
row_click_route = "/vertraege/:id"

[[tables.vertraege.table.columns]]
field = "vertragsnummer"
label = "labels.vertrag.vertragsnummer"
sortable = true
width = "10%"

[[tables.vertraege.table.columns]]
field = "mieter.computed.display_name"
label = "labels.vertrag.mieter"
sortable = true
width = "20%"

[[tables.vertraege.table.columns]]
field = "einheit.bezeichnung"
label = "labels.vertrag.einheit"
sortable = true
width = "15%"

[[tables.vertraege.table.columns]]
field = "beginn"
label = "labels.vertrag.beginn"
sortable = true
width = "10%"
format = "date"

[[tables.vertraege.table.columns]]
field = "ende"
label = "labels.vertrag.ende"
sortable = true
width = "10%"
format = "date"
empty_text = "unbefristet"

[[tables.vertraege.table.columns]]
field = "computed.gesamtmiete"
label = "labels.vertrag.gesamtmiete"
sortable = true
width = "12%"
format = "currency"

[[tables.vertraege.table.columns]]
field = "computed.ist_aktiv"
label = "labels.vertrag.status"
width = "10%"
display = "status_indicator"
status_map = { true = { label = "aktiv", color = "green" }, false = { label = "beendet", color = "gray" } }

[tables.vertraege.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/vertrag.form" }
kuendigen = { icon = "XCircle", dialog = "dialogs/kuendigung", visible_if = { field = "computed.ist_aktiv", equals = true } }

[tables.zaehler.table]
entity = "zaehler"

[[tables.zaehler.table.columns]]
field = "objekt.bezeichnung"
label = "labels.zaehler.objekt"
sortable = true
width = "20%"

[[tables.zaehler.table.columns]]
field = "einheit.bezeichnung"
label = "labels.zaehler.einheit"
width = "15%"
empty_text = "Hauptzähler"

[[tables.zaehler.table.columns]]
field = "typ"
label = "labels.zaehler.typ"
sortable = true
width = "12%"
display = "badge"

[[tables.zaehler.table.columns]]
field = "zaehlernummer"
label = "labels.zaehler.nummer"
width = "15%"

[[tables.zaehler.table.columns]]
field = "ist_hauptzaehler"
label = "labels.zaehler.haupt"
width = "8%"
display = "boolean_icon"

[[tables.zaehler.table.columns]]
field = "computed.letzter_stand.stand"
label = "labels.zaehler.letzter_stand"
width = "15%"
template = "{value} {messeinheit}"

[[tables.zaehler.table.columns]]
field = "computed.letzter_stand.datum"
label = "labels.zaehler.abgelesen_am"
sortable = true
width = "15%"
format = "date"

[tables.zaehler.table.row_actions]
ablesung = { icon = "Plus", dialog = "forms/zaehlerstand.form", defaults = { zaehler_id = ":id" } }
edit = { icon = "Pencil", dialog = "forms/zaehler.form" }
historie = { icon = "History", dialog = "dialogs/zaehler_historie" }

[tables.zahlungen.table]
entity = "zahlung"

[[tables.zahlungen.table.columns]]
field = "datum"
label = "labels.zahlung.datum"
sortable = true
width = "12%"
format = "date"

[[tables.zahlungen.table.columns]]
field = "vertrag.mieter.computed.display_name"
label = "labels.zahlung.mieter"
sortable = true
width = "20%"

[[tables.zahlungen.table.columns]]
field = "vertrag.einheit.bezeichnung"
label = "labels.zahlung.einheit"
width = "15%"

[[tables.zahlungen.table.columns]]
field = "betrag"
label = "labels.zahlung.betrag"
sortable = true
width = "12%"
format = "currency"

[[tables.zahlungen.table.columns]]
field = "typ"
label = "labels.zahlung.typ"
sortable = true
width = "12%"
display = "badge"

[[tables.zahlungen.table.columns]]
field = "monat_fuer"
label = "labels.zahlung.monat_fuer"
sortable = true
width = "10%"
format = "month"

[[tables.zahlungen.table.columns]]
field = "verwendungszweck"
label = "labels.zahlung.verwendungszweck"
width = "19%"
truncate = 30

[tables.zahlungen.table.row_actions]
edit = { icon = "Pencil", dialog = "forms/zahlung.form" }
delete = { icon = "Trash2", confirm = true }

[views.dashboard]
id = "dashboard"
title = "labels.views.dashboard"
route = "/dashboard"
layout = "dashboard"

[[view.widgets]]
id = "monatsuebersicht"
type = "stats_card"
title = "labels.dashboard.monatsübersicht"
position = { row = 1, col = 1, width = 2 }

  [[view.widgets.stats]]
  label = "labels.dashboard.soll_gesamt"
  value = { query = "sum(sollstellung where monat = current_month).sollbetrag" }
  format = "currency"

  [[view.widgets.stats]]
  label = "labels.dashboard.ist_gesamt"
  value = { query = "sum(sollstellung where monat = current_month).istbetrag" }
  format = "currency"

  [[view.widgets.stats]]
  label = "labels.dashboard.offen"
  value = { query = "sum(sollstellung where monat = current_month and status != 'bezahlt').differenz" }
  format = "currency"
  color_rule = { negative = "red", zero = "green" }

[[view.widgets]]
id = "offene_posten"
type = "table_widget"
title = "labels.dashboard.offene_posten"
position = { row = 1, col = 3, width = 2 }
table = "tables/sollstellungen_offen.table"
max_rows = 5
show_more_link = "/finanzen/sollstellung?filter=offen"

[[view.widgets]]
id = "erinnerungen"
type = "list_widget"
title = "labels.dashboard.erinnerungen"
position = { row = 2, col = 1, width = 2 }
query = "erinnerung where status = 'offen' order by faellig_am limit 10"
item_template = { title = "titel", subtitle = "faellig_am", icon_from = "typ" }
empty_message = "labels.dashboard.keine_erinnerungen"

[[view.widgets]]
id = "leerstand"
type = "stats_card"
title = "labels.dashboard.leerstand"
position = { row = 2, col = 3, width = 1 }

  [[view.widgets.stats]]
  label = "labels.dashboard.einheiten_leer"
  value = { query = "count(einheit where status = 'leer')" }
  total = { query = "count(einheit)" }
  format = "fraction"

[[view.widgets]]
id = "quick_actions"
type = "action_buttons"
title = "labels.dashboard.schnellzugriff"
position = { row = 2, col = 4, width = 1 }

  [[view.widgets.actions]]
  label = "labels.actions.zahlung_erfassen"
  icon = "Plus"
  dialog = "forms/zahlung.form"

  [[view.widgets.actions]]
  label = "labels.actions.rechnung_erfassen"
  icon = "Receipt"
  dialog = "forms/rechnung.form"

  [[view.widgets.actions]]
  label = "labels.actions.zaehler_ablesen"
  icon = "Gauge"
  dialog = "forms/zaehlerstand.form"

[views.dokumente]
id = "dokumente"
title = "labels.views.dokumente"
route = "/dokumente"
layout = "single"

[views.dokumente.content]
table = "tables/dokumente.table"
default_sort = { field = "hochgeladen_am", direction = "desc" }

  [[view.content.filters]]
  field = "objekt_id"
  type = "select"
  label = "labels.filter.objekt"
  options_from = "objekt"

  [[view.content.filters]]
  field = "typ"
  type = "select"
  label = "labels.filter.typ"

  [[view.content.filters]]
  field = "jahr"
  type = "year_picker"
  label = "labels.filter.jahr"

[views.dokumente.content.actions]
upload = { label = "labels.actions.dokument_hochladen", dialog = "forms/dokument.form" }

[views.dokumente.content.bulk_actions]
export = { label = "labels.actions.steuerberater_export", dialog = "dialogs/steuerberater_export" }
delete = { label = "labels.actions.loeschen", confirm = true }

[views.einstellungen]
id = "einstellungen"
title = "labels.views.einstellungen"
route = "/einstellungen"
layout = "settings"

  [[view.sections]]
  id = "eigentuemer"
  label = "labels.settings.eigentuemer"
  icon = "User"
  form = "forms/eigentuemer.form"
  description = "labels.settings.eigentuemer_desc"

  [[view.sections]]
  id = "kostenarten"
  label = "labels.settings.kostenarten"
  icon = "Tag"
  type = "table_editable"
  table = "tables/kostenarten.table"
  form = "forms/kostenart.form"
  description = "labels.settings.kostenarten_desc"

  [[view.sections]]
  id = "umlageschluessel"
  label = "labels.settings.umlageschluessel"
  icon = "Percent"
  type = "info"
  content = "catalogs/umlageschluessel.catalog"
  description = "labels.settings.umlageschluessel_desc"

  [[view.sections]]
  id = "backup"
  label = "labels.settings.backup"
  icon = "Database"
  type = "actions"
  description = "labels.settings.backup_desc"

    [[view.sections.actions]]
    id = "backup_create"
    label = "labels.actions.backup_erstellen"
    handler = "system.createBackup"

    [[view.sections.actions]]
    id = "backup_restore"
    label = "labels.actions.backup_wiederherstellen"
    handler = "system.restoreBackup"
    confirm = true

[views.finanzen]
id = "finanzen"
title = "labels.views.finanzen"
route = "/finanzen"
layout = "tabbed"

  [[view.tabs]]
  id = "zahlungen"
  label = "labels.tabs.zahlungen"
  route = "/finanzen/zahlungen"
  table = "tables/zahlungen.table"
  default_sort = { field = "datum", direction = "desc" }

    [[view.tabs.filters]]
    field = "datum"
    type = "date_range"
    label = "labels.filter.zeitraum"

    [[view.tabs.filters]]
    field = "typ"
    type = "select"

  [view.tabs.actions]
  create = { label = "labels.actions.zahlung_erfassen", dialog = "forms/zahlung.form" }

  [[view.tabs]]
  id = "sollstellung"
  label = "labels.tabs.sollstellung"
  route = "/finanzen/sollstellung"
  table = "tables/sollstellungen.table"

    [[view.tabs.filters]]
    field = "monat"
    type = "month_picker"
    default = "current"

    [[view.tabs.filters]]
    field = "status"
    type = "select"

  [view.tabs.summary]
  show = true
  fields = ["sollbetrag", "istbetrag", "differenz"]
  aggregate = "sum"

  [[view.tabs]]
  id = "kautionen"
  label = "labels.tabs.kautionen"
  route = "/finanzen/kautionen"
  table = "tables/kautionen.table"

    [[view.tabs.filters]]
    field = "status"
    type = "select"

  [view.tabs.summary]
  show = true
  fields = ["betrag"]
  aggregate = "sum"
  group_by = "status"

[views.mieter]
id = "mieter"
title = "labels.views.mieter"
route = "/mieter"
layout = "list_detail"

[views.mieter.list]
table = "tables/mieter.table"
search_fields = ["vorname", "nachname", "email"]
default_sort = { field = "nachname", direction = "asc" }

  [[view.list.filters]]
  field = "status"
  type = "select"
  label = "labels.filter.status"
  default = "aktiv"

[views.mieter.list.actions]
create = { label = "labels.actions.mieter_anlegen", dialog = "forms/mieter.form" }

[views.mieter.detail]
route = "/mieter/:id"
title_field = "computed.display_name"

  [[view.detail.tabs]]
  id = "stammdaten"
  label = "labels.tabs.stammdaten"
  type = "form_readonly"
  form = "forms/mieter.form"
  edit_action = { dialog = "forms/mieter.form" }

  [[view.detail.tabs]]
  id = "vertrag"
  label = "labels.tabs.vertrag"
  type = "table"
  table = "tables/vertraege.table"
  filter = { mieter_id = ":id" }

  [[view.detail.tabs]]
  id = "zahlungen"
  label = "labels.tabs.zahlungen"
  type = "table"
  table = "tables/zahlungen.table"
  filter = { "vertrag.mieter_id" = ":id" }
  actions = { create = { label = "labels.actions.zahlung_erfassen", dialog = "forms/zahlung.form" } }

  [[view.detail.tabs]]
  id = "dokumente"
  label = "labels.tabs.dokumente"
  type = "table"
  table = "tables/dokumente.table"
  filter = { mieter_id = ":id" }
  actions = { upload = { label = "labels.actions.dokument_hochladen", dialog = "forms/dokument.form", defaults = { mieter_id = ":id" } } }

  [[view.detail.tabs]]
  id = "kaution"
  label = "labels.tabs.kaution"
  type = "form_readonly"
  form = "forms/kaution.form"
  data_path = "aktiver_vertrag.kaution"
  empty_message = "labels.kaution.keine_kaution"

[views.nebenkosten]
id = "nebenkosten"
title = "labels.views.nebenkosten"
route = "/nebenkosten"
layout = "tabbed"

  [[view.tabs]]
  id = "rechnungen"
  label = "labels.tabs.rechnungen"
  route = "/nebenkosten/rechnungen"
  table = "tables/rechnungen.table"
  default_sort = { field = "rechnungsdatum", direction = "desc" }

    [[view.tabs.filters]]
    field = "objekt_id"
    type = "select"
    label = "labels.filter.objekt"
    options_from = "objekt"

    [[view.tabs.filters]]
    field = "kostenart_id"
    type = "select"
    label = "labels.filter.kostenart"
    options_from = "kostenart"

    [[view.tabs.filters]]
    field = "computed.jahr"
    type = "year_picker"
    label = "labels.filter.jahr"

    [[view.tabs.filters]]
    field = "computed.ist_bezahlt"
    type = "boolean_toggle"
    label = "labels.filter.bezahlt"

  [view.tabs.actions]
  create = { label = "labels.actions.rechnung_erfassen", dialog = "forms/rechnung.form" }

  [view.tabs.summary]
  show = true
  fields = ["betrag"]
  aggregate = "sum"
  group_by = "kostenart.bezeichnung"

  [[view.tabs]]
  id = "abrechnungen"
  label = "labels.tabs.abrechnungen"
  route = "/nebenkosten/abrechnungen"
  table = "tables/abrechnungen.table"

    [[view.tabs.filters]]
    field = "objekt_id"
    type = "select"
    options_from = "objekt"

    [[view.tabs.filters]]
    field = "jahr"
    type = "year_picker"

    [[view.tabs.filters]]
    field = "status"
    type = "select"

  [view.tabs.actions]
  create = { label = "labels.actions.abrechnung_erstellen", dialog = "dialogs/nk_abrechnung_wizard" }

  [[view.tabs]]
  id = "zaehler"
  label = "labels.tabs.zaehler"
  route = "/nebenkosten/zaehler"
  table = "tables/zaehler.table"

    [[view.tabs.filters]]
    field = "objekt_id"
    type = "select"
    options_from = "objekt"

    [[view.tabs.filters]]
    field = "typ"
    type = "select"

  [view.tabs.actions]
  create = { label = "labels.actions.zaehler_anlegen", dialog = "forms/zaehler.form" }
  ablesung = { label = "labels.actions.ablesung_erfassen", dialog = "forms/zaehlerstand.form" }

[views.objekte]
id = "objekte"
title = "labels.views.objekte"
route = "/objekte"
layout = "list_detail"

[views.objekte.list]
table = "tables/objekte.table"
search_fields = ["bezeichnung", "adresse", "ort"]
default_sort = { field = "bezeichnung", direction = "asc" }

  [[view.list.filters]]
  field = "typ"
  type = "select"
  label = "labels.filter.typ"

  [[view.list.filters]]
  field = "computed.leerstand"
  type = "boolean"
  label = "labels.filter.mit_leerstand"
  condition = "> 0"

[views.objekte.list.actions]
create = { label = "labels.actions.objekt_anlegen", dialog = "forms/objekt.form" }

[views.objekte.detail]
route = "/objekte/:id"
title_field = "bezeichnung"

  [[view.detail.tabs]]
  id = "stammdaten"
  label = "labels.tabs.stammdaten"
  type = "form_readonly"
  form = "forms/objekt.form"
  edit_action = { dialog = "forms/objekt.form" }

  [[view.detail.tabs]]
  id = "einheiten"
  label = "labels.tabs.einheiten"
  type = "table"
  table = "tables/einheiten.table"
  filter = { objekt_id = ":id" }
  actions = { create = { label = "labels.actions.einheit_anlegen", dialog = "forms/einheit.form", defaults = { objekt_id = ":id" } } }

  [[view.detail.tabs]]
  id = "zaehler"
  label = "labels.tabs.zaehler"
  type = "table"
  table = "tables/zaehler.table"
  filter = { objekt_id = ":id" }
  visible_if = { field = "ist_multi_einheit", equals = true }
  actions = { create = { label = "labels.actions.zaehler_anlegen", dialog = "forms/zaehler.form", defaults = { objekt_id = ":id" } } }

  [[view.detail.tabs]]
  id = "rechnungen"
  label = "labels.tabs.rechnungen"
  type = "table"
  table = "tables/rechnungen.table"
  filter = { objekt_id = ":id" }
  actions = { create = { label = "labels.actions.rechnung_erfassen", dialog = "forms/rechnung.form", defaults = { objekt_id = ":id" } } }

  [[view.detail.tabs]]
  id = "dokumente"
  label = "labels.tabs.dokumente"
  type = "table"
  table = "tables/dokumente.table"
  filter = { objekt_id = ":id" }
  actions = { upload = { label = "labels.actions.dokument_hochladen", dialog = "forms/dokument.form", defaults = { objekt_id = ":id" } } }

[views.vertraege]
id = "vertraege"
title = "labels.views.vertraege"
route = "/vertraege"
layout = "list_detail"

[views.vertraege.list]
table = "tables/vertraege.table"
search_fields = ["mieter.nachname", "einheit.bezeichnung", "vertragsnummer"]
default_sort = { field = "beginn", direction = "desc" }

  [[view.list.filters]]
  field = "computed.ist_aktiv"
  type = "boolean_toggle"
  label = "labels.filter.nur_aktive"
  default = true

  [[view.list.filters]]
  field = "typ"
  type = "select"
  label = "labels.filter.typ"

[views.vertraege.list.actions]
create = { label = "labels.actions.vertrag_anlegen", dialog = "forms/vertrag.form" }

[views.vertraege.detail]
route = "/vertraege/:id"
title_field = "vertragsnummer"

  [[view.detail.header_info]]
  fields = ["mieter.computed.display_name", "einheit.bezeichnung", "computed.gesamtmiete"]

  [[view.detail.tabs]]
  id = "konditionen"
  label = "labels.tabs.konditionen"
  type = "form_readonly"
  form = "forms/vertrag.form"
  edit_action = { dialog = "forms/vertrag.form" }

  [[view.detail.tabs]]
  id = "kaution"
  label = "labels.tabs.kaution"
  type = "form_editable"
  form = "forms/kaution.form"
  data_path = "kaution"

  [[view.detail.tabs]]
  id = "zahlungen"
  label = "labels.tabs.zahlungen"
  type = "table"
  table = "tables/zahlungen.table"
  filter = { vertrag_id = ":id" }

  [[view.detail.tabs]]
  id = "sollstellung"
  label = "labels.tabs.sollstellung"
  type = "table"
  table = "tables/sollstellungen.table"
  filter = { vertrag_id = ":id" }

  [[view.detail.tabs]]
  id = "dokumente"
  label = "labels.tabs.dokumente"
  type = "table"
  table = "tables/dokumente.table"
  filter = { vertrag_id = ":id" }

# =============================================================================
# IMPORTS - Externe Konfigurationsdateien (Kataloge, Labels, Validierung, Design)
# =============================================================================
[imports]
catalogs = ["config/catalogs/*.catalog.toml"]
labels = ["config/labels/*.labels.toml"]
validation = ["config/validation/rules.config.toml"]
design = ["config/themes/design-system.config.toml"]
